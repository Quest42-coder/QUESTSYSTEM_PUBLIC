<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QUESTSYSTEM · Modul-Karte (v2)</title>
<style>
  :root{
    --bg:#0b0b0b; --fg:#f5f5f5;
    --red:#e74c3c; --yellow:#f1c40f; --blue:#3498db;
    --muted:#7a7a7a; --grid:#1a1a1a; --edge:#9aa4b0;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header,footer{max-width:1200px;margin:0 auto;padding:14px 16px}
  header a{color:var(--fg);opacity:.9;text-decoration:none;border-bottom:1px dotted currentColor}
  .wrap{max-width:1200px;margin:0 auto;padding:0 16px 20px}
  .board{width:100%;aspect-ratio:1/1;background:
    radial-gradient(1200px 1200px at 50% 50%, #111 0%, #0d0d0d 55%, #0b0b0b 100%);
    border-radius:12px;overflow:hidden;box-shadow:0 0 0 1px #111 inset}
  svg{width:100%;height:100%;touch-action:none}
  .grid circle{fill:none;stroke:var(--grid);stroke-width:1}
  .ring{fill:none;stroke:rgba(255,255,255,.12);stroke-width:2}
  .edge{stroke:var(--edge);stroke-width:1.5;opacity:0;transition:opacity .12s}
  .edge.on{opacity:.95}
  .node{cursor:pointer;transition:transform .15s ease}
  .node:focus{outline:none}
  .dot{stroke:#000;stroke-width:.75}
  .label{font-size:12px;fill:var(--fg);text-anchor:middle;pointer-events:none}
  .label.bg{fill:#000;opacity:.45}
  .legend{display:flex;gap:12px;align-items:center;margin:8px 0 0;flex-wrap:wrap}
  .pill{display:inline-flex;gap:6px;align-items:center;font-size:.92rem;opacity:.9}
  .swatch{width:10px;height:10px;border-radius:50%}
  .red{background:var(--red)} .yellow{background:var(--yellow)} .blue{background:var(--blue)}
  .hint{opacity:.8;font-size:.95rem;margin:6px 0 0}
  .toolbar{display:flex;gap:8px;align-items:center;margin:8px 0 0;flex-wrap:wrap}
  .btn{background:#151515;border:1px solid #222;color:#eee;border-radius:8px;padding:8px 10px;font-size:.92rem;cursor:pointer}
  .btn:hover{background:#1a1a1a}
  @media (max-width:720px){
    .label{font-size:10px}
  }
</style>
</head>
<body>
<header>
  <a href="./">← QUESTSYSTEM</a>
  <div class="legend">
    <span class="pill"><span class="swatch red"></span>Existential</span>
    <span class="pill"><span class="swatch yellow"></span>Societal</span>
    <span class="pill"><span class="swatch blue"></span>Structural</span>
  </div>
  <div class="hint">Maus/Trackpad: scrollen = Zoom, ziehen = Pan, <kbd>Doppelklick</kbd> = Reset. Mobile: Pinch-Zoom & Drag, Doppeltipp = Reset. Hover/Tippen zeigt Verknüpfungen. Klick öffnet Details.</div>
  <div class="toolbar">
    <button class="btn" id="fitBtn">Auf Bildschirm zentrieren</button>
    <button class="btn" id="resetBtn">Zoom/Position zurücksetzen</button>
    <button class="btn" id="toggleEdgesBtn">Alle Verbindungen anzeigen/aus</button>
  </div>
</header>

<div class="wrap">
  <div class="board">
    <svg viewBox="0 0 1000 1000" role="img" aria-labelledby="title desc">
      <title id="title">QUESTSYSTEM – Modul-Karte</title>
      <desc id="desc">42 Module in drei Ringen. Hover/Tippen zeigt Verbindungen. Klick öffnet die Modul-Datei.</desc>

      <!-- Pan/Zoom-Container -->
      <g id="viewport">
        <!-- dezente Hilfsringe -->
        <g class="grid">
          <circle cx="500" cy="500" r="160"></circle>
          <circle cx="500" cy="500" r="260"></circle>
          <circle cx="500" cy="500" r="360"></circle>
          <circle cx="500" cy="500" r="460"></circle>
        </g>

        <!-- Ringe -->
        <circle class="ring" cx="500" cy="500" r="220"></circle>
        <circle class="ring" cx="500" cy="500" r="320"></circle>
        <circle class="ring" cx="500" cy="500" r="420"></circle>

        <g id="edges"></g>
        <g id="nodes"></g>
      </g>
    </svg>
  </div>
</div>

<footer>
  © QUESTSYSTEM · Lizenz: CC BY-SA 4.0 + Dignity Clause · Version: map.html v2
</footer>

<script>
/* =========================
   Daten
   ========================= */
const MODULES = [
  // Existential (01–09) – rot
  {id:1,  key:'RESETBOX',  ring:'red'},
  {id:2,  key:'WATER',     ring:'red'},
  {id:3,  key:'SHELTER',   ring:'red'},
  {id:4,  key:'FOOD',      ring:'red'},
  {id:5,  key:'SLEEP',     ring:'red'},
  {id:6,  key:'BODY',      ring:'red'},
  {id:7,  key:'PSYCH',     ring:'red'}, // falls du PSYCHE nutzt, unten in FILE_NAME_OVERRIDES ändern
  {id:8,  key:'DEVICE',    ring:'red'},
  {id:9,  key:'DEBT',      ring:'red'},
  // Societal (10–24) – gelb
  {id:10, key:'WORK',      ring:'yellow'},
  {id:11, key:'SCHOOL',    ring:'yellow'},
  {id:12, key:'BORDER',    ring:'yellow'},
  {id:13, key:'NATURE',    ring:'yellow'},
  {id:14, key:'HEALTH',    ring:'yellow'},
  {id:15, key:'CARE',      ring:'yellow'},
  {id:16, key:'FAMILY',    ring:'yellow'},
  {id:17, key:'ANIMAL',    ring:'yellow'},
  {id:18, key:'CULTURE',   ring:'yellow'},
  {id:19, key:'MEDIA',     ring:'yellow'},
  {id:20, key:'ENERGY',    ring:'yellow'},
  {id:21, key:'CLIMATE',   ring:'yellow'},
  {id:22, key:'MIGRATION', ring:'yellow'},
  {id:23, key:'JUSTICE',   ring:'yellow'},
  {id:24, key:'COMMUNITY', ring:'yellow'},
  // Structural (25–42) – blau
  {id:25, key:'FINANCE',   ring:'blue'},
  {id:26, key:'HOUSING',   ring:'blue'},
  {id:27, key:'TRANSPORT', ring:'blue'},
  {id:28, key:'NETWORK',   ring:'blue'},
  {id:29, key:'SYMBOL',    ring:'blue'},
  {id:30, key:'TRUTH',     ring:'blue'},
  {id:31, key:'MEMORY',    ring:'blue'},
  {id:32, key:'LICENCE',   ring:'blue'},
  {id:33, key:'PRIVACY',   ring:'blue'},
  {id:34, key:'SECURITY',  ring:'blue'},
  {id:35, key:'DATA',      ring:'blue'},
  {id:36, key:'CONFLICT',  ring:'blue'},
  {id:37, key:'DEMOCRACY', ring:'blue'},
  {id:38, key:'GOVERNANCE',ring:'blue'},
  {id:39, key:'KNOWLEDGE', ring:'blue'},
  {id:40, key:'ART',       ring:'blue'},
  {id:41, key:'FUTURE',    ring:'blue'},
  {id:42, key:'DEATH',     ring:'blue'},
];

/* Falls Dateinamen von der Regel abweichen: hier überschreiben */
const FILE_NAME_OVERRIDES = {
  7: 'MODULES/Modul_07_PSYCH.md',
  // Beispiel: 20: 'MODULES/Modul_20_ENERGIE.md'
};

/* Verbindungs-Matrix (erweitert; frei anpassbar)
   Ziel: mind. 3 sinnvolle Verknüpfungen pro Modul.
   Tipp: Du kannst hier jederzeit ergänzen/ändern.
*/
const CONNECTIONS = {
  // Existential
  1:[2,3,9,20,28,30],     // RESETBOX
  2:[4,6,13,1,20],        // WATER
  3:[5,13,1,26],          // SHELTER
  4:[2,13,25,1],          // FOOD
  5:[3,7,6,14],           // SLEEP
  6:[2,5,14,33],          // BODY
  7:[5,6,31,33,14],       // PSYCH(E)
  8:[20,28,35,33,1],      // DEVICE
  9:[25,23,32,1],         // DEBT

  // Societal
  10:[25,23,28,38],       // WORK
  11:[30,39,28,31],       // SCHOOL
  12:[23,22,38,33],       // BORDER
  13:[2,3,4,21],          // NATURE
  14:[6,7,23,33],         // HEALTH
  15:[14,16,23,24],       // CARE
  16:[15,14,24,26],       // FAMILY
  17:[13,15,24,14],       // ANIMAL
  18:[19,29,24,40],       // CULTURE
  19:[18,30,28,33],       // MEDIA
  20:[8,28,2,25],         // ENERGY
  21:[13,20,28,37],       // CLIMATE
  22:[12,23,24,33],       // MIGRATION
  23:[9,10,12,30],        // JUSTICE
  24:[15,16,17,28],       // COMMUNITY

  // Structural
  25:[9,10,20,26],        // FINANCE
  26:[3,16,25,24],        // HOUSING
  27:[28,26,25,21],       // TRANSPORT
  28:[8,19,20,24,21],     // NETWORK
  29:[18,30,40,24],       // SYMBOL
  30:[11,19,23,33,1],     // TRUTH
  31:[7,11,39,35],        // MEMORY
  32:[23,30,33,25],       // LICENCE
  33:[8,14,19,30,34],     // PRIVACY
  34:[33,35,36,28],       // SECURITY
  35:[8,31,33,39],        // DATA
  36:[34,23,37,38],       // CONFLICT
  37:[21,36,38,30],       // DEMOCRACY
  38:[10,12,36,37,30],    // GOVERNANCE
  39:[11,31,35,30],       // KNOWLEDGE
  40:[18,29,30,24],       // ART
  41:[21,30,39,24],       // FUTURE
  42:[30,23,31,39],       // DEATH
};

/* =========================
   Layout
   ========================= */
const center = {x:500, y:500};
const radii = { red:220, yellow:320, blue:420 };
const groups = {
  red:   MODULES.filter(m=>m.ring==='red'),
  yellow:MODULES.filter(m=>m.ring==='yellow'),
  blue:  MODULES.filter(m=>m.ring==='blue')
};
function place(group, r){
  const n = group.length, start = -Math.PI/2;
  return group.map((m,i)=>{
    const a = start + i*(2*Math.PI/n);
    return {...m, r, a, x:center.x + r*Math.cos(a), y:center.y + r*Math.sin(a)};
  });
}
const layout = [
  ...place(groups.red,   radii.red),
  ...place(groups.yellow,radii.yellow),
  ...place(groups.blue,  radii.blue)
];

const fillOf = (ring)=> ring==='red'?'var(--red)': ring==='yellow'?'var(--yellow)':'var(--blue)';

/* =========================
   Render
   ========================= */
const vp = document.getElementById('viewport');
const gEdges = document.getElementById('edges');
const gNodes = document.getElementById('nodes');

const nodeById = new Map();
layout.forEach(m => nodeById.set(m.id, m));

const edges = [];
Object.entries(CONNECTIONS).forEach(([from, targets])=>{
  const a = nodeById.get(+from);
  (targets||[]).forEach(t=>{
    const b = nodeById.get(+t);
    if(!a||!b) return;
    const e = document.createElementNS('http://www.w3.org/2000/svg','line');
    e.setAttribute('x1', a.x); e.setAttribute('y1', a.y);
    e.setAttribute('x2', b.x); e.setAttribute('y2', b.y);
    e.setAttribute('class','edge');
    gEdges.appendChild(e);
    edges.push({key:`${a.id}-${b.id}`, el:e, a:a.id, b:b.id});
  });
});

function toggleEdgesFor(id, on){
  edges.forEach(({a,b,el})=>{
    if(a===id || b===id) el.classList.toggle('on', !!on);
  });
}
let showAllEdges = false;
function setAllEdges(on){
  showAllEdges = !!on;
  edges.forEach(e=>e.el.classList.toggle('on', showAllEdges));
}

function linkFor(m){
  if(FILE_NAME_OVERRIDES[m.id]) return `module.html?file=${encodeURIComponent(FILE_NAME_OVERRIDES[m.id])}`;
  const file = `MODULES/Modul_${String(m.id).padStart(2,'0')}_${m.key}.md`;
  return `module.html?file=${encodeURIComponent(file)}`;
}

layout.forEach(m=>{
  const a = document.createElementNS('http://www.w3.org/2000/svg','a');
  a.setAttributeNS('http://www.w3.org/1999/xlink','href', linkFor(m));
  a.setAttribute('target','_self');

  const g = document.createElementNS('http://www.w3.org/2000/svg','g');
  g.setAttribute('class','node');
  g.setAttribute('transform',`translate(${m.x},${m.y})`);
  g.addEventListener('mouseenter', ()=>!showAllEdges && toggleEdgesFor(m.id,true));
  g.addEventListener('mouseleave', ()=>!showAllEdges && toggleEdgesFor(m.id,false));
  g.addEventListener('touchstart', (ev)=>{ ev.preventDefault(); if(!showAllEdges) g._on = !g._on, toggleEdgesFor(m.id,g._on); });

  const dot = document.createElementNS('http://www.w3.org/2000/svg','circle');
  dot.setAttribute('r', 9); dot.setAttribute('class','dot'); dot.setAttribute('fill', fillOf(m.ring));
  g.appendChild(dot);

  const labelBg = document.createElementNS('http://www.w3.org/2000/svg','text');
  labelBg.setAttribute('y', -14); labelBg.setAttribute('class','label bg');
  labelBg.textContent = `${String(m.id).padStart(2,'0')} ${m.key}`;
  const label = document.createElementNS('http://www.w3.org/2000/svg','text');
  label.setAttribute('y', -14); label.setAttribute('class','label');
  label.textContent = `${String(m.id).padStart(2,'0')} ${m.key}`;
  g.appendChild(labelBg); g.appendChild(label);

  g.setAttribute('tabindex','0');
  g.addEventListener('focus', ()=>!showAllEdges && toggleEdgesFor(m.id,true));
  g.addEventListener('blur',  ()=>!showAllEdges && toggleEdgesFor(m.id,false));

  a.appendChild(g); gNodes.appendChild(a);
});

/* =========================
   Pan & Zoom (ohne Libs)
   ========================= */
let state = { k:1, x:0, y:0 }; // scale + translate
const svg = document.querySelector('svg');
function applyTransform(){ vp.setAttribute('transform',`translate(${state.x},${state.y}) scale(${state.k})`); }

function screenToSvg(pt){
  const ctm = svg.getScreenCTM();
  return {
    x:(pt.x - ctm.e)/ctm.a,
    y:(pt.y - ctm.f)/ctm.d
  };
}

let dragging = false, dragStart = {x:0,y:0}, startState={x:0,y:0};
svg.addEventListener('mousedown', e=>{ dragging = true; dragStart={x:e.clientX,y:e.clientY}; startState={...state}; });
window.addEventListener('mousemove', e=>{
  if(!dragging) return;
  state.x = startState.x + (e.clientX - dragStart.x);
  state.y = startState.y + (e.clientY - dragStart.y);
  applyTransform();
});
window.addEventListener('mouseup', ()=> dragging=false);

// Touch drag
svg.addEventListener('touchstart', e=>{
  if(e.touches.length===1){
    dragging = true; dragStart={x:e.touches[0].clientX,y:e.touches[0].clientY}; startState={...state};
  }
},{passive:false});
svg.addEventListener('touchmove', e=>{
  if(dragging && e.touches.length===1){
    state.x = startState.x + (e.touches[0].clientX - dragStart.x);
    state.y = startState.y + (e.touches[0].clientY - dragStart.y);
    applyTransform();
  }
},{passive:false});
svg.addEventListener('touchend', ()=> dragging=false);

// Wheel zoom
svg.addEventListener('wheel', e=>{
  e.preventDefault();
  const delta = Math.sign(e.deltaY) * -0.1;
  const newK = Math.min(3.2, Math.max(0.5, state.k + delta));
  const pt = screenToSvg({x:e.clientX,y:e.clientY});
  // Zoom um Mauspunkt
  state.x = pt.x - (pt.x - state.x) * (newK/state.k);
  state.y = pt.y - (pt.y - state.y) * (newK/state.k);
  state.k = newK;
  applyTransform();
},{passive:false});

// Double click/tap reset
let lastTap=0;
svg.addEventListener('dblclick', ()=>reset());
svg.addEventListener('touchend', e=>{
  const now=Date.now();
  if(now-lastTap<300){ reset(); }
  lastTap=now;
});

function fit(){
  state = {k:1, x:0, y:0};
  // leicht herauszoomen für Ränder
  state.k = 0.92; state.x = 40; state.y = 40;
  applyTransform();
}
function reset(){ state = {k:1,x:0,y:0}; applyTransform(); }
document.getElementById('fitBtn').addEventListener('click', fit);
document.getElementById('resetBtn').addEventListener('click', reset);
document.getElementById('toggleEdgesBtn').addEventListener('click', ()=> setAllEdges(!showAllEdges));
fit();
</script>

<noscript>
  <div style="max-width:1200px;margin:12px auto;color:#fff;opacity:.85;padding:0 16px">
    <strong>Hinweis:</strong> Für die interaktive Modul-Karte wird JavaScript benötigt.
  </div>
</noscript>
</body>
</html>
