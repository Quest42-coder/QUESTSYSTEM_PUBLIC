<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QUESTSYSTEM – Modul</title>
<meta name="description" content="Anzeige einzelner QUESTSYSTEM-Module (Markdown) mit Direktlink ins Repository." />
<style>
  :root{
    --bg:#0d1117; --fg:#e6eef7; --muted:#9fb0c6; --link:#a8d1ff;
    --panel:#111827; --border:#1f2a3b; --code:#0e1423;
  }
  *{box-sizing:border-box}
  body{margin:0; background:var(--bg); color:var(--fg); font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

  /* Header */
  .site-header{position:sticky; top:0; z-index:10; display:flex; gap:12px; align-items:center;
    padding:10px 14px; background:rgba(17,24,39,.92); border-bottom:1px solid var(--border); backdrop-filter: blur(4px)}
  .site-header h1{margin:0; font-size:16px}
  .site-header .spacer{flex:1}
  .site-header a{color:var(--fg); text-decoration:none; opacity:.9}
  .site-header a:hover{text-decoration:underline; opacity:1}
  .btn{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--border);
       border-radius:8px; background:#141c2a; color:var(--fg); text-decoration:none; font-size:14px}
  .btn:hover{border-color:#2a3956}

  /* Container */
  .wrap{max-width:1000px; margin:24px auto 56px; padding:0 16px}

  /* Markdown Basic */
  article{line-height:1.6}
  article h1,article h2,article h3,article h4{margin:1.2em 0 .6em}
  article h1{font-size:28px} article h2{font-size:22px} article h3{font-size:18px}
  article p{margin:.8em 0}
  article a{color:var(--link)}
  article ul,article ol{margin:.6em 0 .6em 1.2em}
  article li{margin:.3em 0}
  article code{background:var(--code); border:1px solid var(--border); border-radius:6px; padding:.1em .35em; font-family:ui-monospace,Menlo,Consolas,monospace}
  pre{background:var(--code); border:1px solid var(--border); border-radius:10px; padding:12px; overflow:auto}
  pre code{border:0; padding:0}
  blockquote{border-left:3px solid #2a3956; margin:.8em 0; padding:.4em .8em; color:#bdd0ea}
  table{border-collapse:collapse; width:100%; margin:1em 0}
  th,td{border:1px solid var(--border); padding:.5em; text-align:left}
  th{background:#121a29}

  /* Info Panel */
  .meta{display:flex; flex-wrap:wrap; gap:8px; margin-bottom:16px}
  .pill{font-size:12px; padding:4px 8px; border:1px solid var(--border); border-radius:999px; background:#121a29; color:var(--muted)}

  /* Error */
  .error{background:#241218; border:1px solid #5b2635; color:#ffd7de; padding:12px; border-radius:10px}
</style>
</head>
<body>
<header class="site-header" aria-label="Seitennavigation">
  <a class="btn" href="index.html">← Start</a>
  <a class="btn" href="index.html#alle-module">Alle Module</a>
  <div class="spacer"></div>
  <a id="openRaw" class="btn" target="_blank" rel="noopener">Raw</a>
  <a id="openBlob" class="btn" target="_blank" rel="noopener">Auf GitHub</a>
</header>

<div class="wrap">
  <div class="meta">
    <span class="pill" id="meta-file"></span>
    <span class="pill" id="meta-size"></span>
    <span class="pill" id="meta-status"></span>
  </div>
  <h1 id="title">Lade Modul…</h1>
  <article id="md"></article>
  <div id="err" class="error" style="display:none"></div>
</div>

<script>
(function(){
  // === Repo-Konfig (falls du Owner/Repo/Branch änderst, hier anpassen) ===
  const OWNER = 'Quest42-coder';
  const REPO  = 'QUESTSYSTEM_PUBLIC';
  const BRANCH= 'main';

  // === Utility ===
  function getParam(name){
    const m = new RegExp('[?&]'+name+'=([^&]+)').exec(location.search);
    return m ? decodeURIComponent(m[1]) : '';
  }
  function rawUrl(path){ return `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${path}`; }
  function blobUrl(path){ return `https://github.com/${OWNER}/${REPO}/blob/${BRANCH}/${path}`; }
  function esc(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  // Sehr einfacher Markdown→HTML-Renderer (überschriften, listen, links, code, tables)
  function mdToHtml(md){
    // code fences
    md = md.replace(/```([\s\S]*?)```/g, (m,code)=>`<pre><code>${esc(code)}</code></pre>`);
    // inline code
    md = md.replace(/`([^`]+)`/g,(m,c)=>`<code>${esc(c)}</code>`);
    // headings
    md = md.replace(/^###### (.*)$/gm,'<h6>$1</h6>')
           .replace(/^##### (.*)$/gm,'<h5>$1</h5>')
           .replace(/^#### (.*)$/gm,'<h4>$1</h4>')
           .replace(/^### (.*)$/gm,'<h3>$1</h3>')
           .replace(/^## (.*)$/gm,'<h2>$1</h2>')
           .replace(/^# (.*)$/gm,'<h1>$1</h1>');
    // blockquote
    md = md.replace(/^\> (.*)$/gm,'<blockquote>$1</blockquote>');
    // links [t](u)
    md = md.replace(/$begin:math:display$([^$end:math:display$]+)\]$begin:math:text$([^)]+)$end:math:text$/g,'<a href="$2" target="_blank" rel="noopener">$1</a>');
    // lists
    md = md.replace(/^(?:\s*)\- (.*)$/gm,'<li>$1</li>');
    md = md.replace(/(<li>.*<\/li>)(?!\s*<\/ul>)/gs,'<ul>$1</ul>');
    // tables (einfache Variante: pipe-reihen)
    if(/\n\|/.test(md)){
      md = md.replace(/(?:^|\n)\|(.+)\|\n\|([ :-|]+)\|\n([\s\S]*?)\n(?=\S)/g, function(_, head, sep, body){
        const th = head.split('|').map(h=>`<th>${h.trim()}</th>`).join('');
        const rows = body.trim().split('\n').map(r=>{
          return '<tr>'+r.replace(/^\|/, '').replace(/\|$/, '').split('|').map(c=>`<td>${c.trim()}</td>`).join('')+'</tr>';
        }).join('');
        return '\n<table><thead><tr>'+th+'</tr></thead><tbody>'+rows+'</tbody></table>\n';
      });
    }
    // paragraphs (nachdem blocks ersetzt wurden)
    md = md.replace(/\n{2,}/g,'</p><p>');
    if(!/^<h\d|<ul|<pre|<table|<blockquote|<p/.test(md)) md = '<p>'+md+'</p>';
    return md;
  }

  // === Main ===
  const file = getParam('file'); // z. B. MODULES/Modul_05_SLEEP.md
  const titleEl = document.getElementById('title');
  const mdEl = document.getElementById('md');
  const errEl = document.getElementById('err');
  const metaFile = document.getElementById('meta-file');
  const metaSize = document.getElementById('meta-size');
  const metaStatus = document.getElementById('meta-status');
  const openRaw = document.getElementById('openRaw');
  const openBlob= document.getElementById('openBlob');

  if(!file){
    titleEl.textContent = 'Kein Datei-Pfad übergeben';
    errEl.style.display='block';
    errEl.innerHTML = 'Rufe die Seite so auf: <code>module.html?file=MODULES/Modul_01_RESETBOX.md</code>';
    document.title = 'QUESTSYSTEM – Fehler';
    return;
  }

  const raw = rawUrl(file);
  const blob= blobUrl(file);
  openRaw.href  = raw;
  openBlob.href = blob;

  titleEl.textContent = file.split('/').pop().replace(/_/g,' ').replace(/\.md$/,'');
  metaFile.textContent = file;

  fetch(raw).then(async r=>{
    metaStatus.textContent = 'HTTP '+r.status;
    if(!r.ok) throw new Error('HTTP '+r.status);
    const text = await r.text();
    metaSize.textContent = (new Blob([text]).size/1024).toFixed(1)+' kB';
    mdEl.innerHTML = mdToHtml(text);
    document.title = 'QUESTSYSTEM – '+titleEl.textContent;
  }).catch(err=>{
    errEl.style.display='block';
    errEl.innerHTML = `<strong>Fehler beim Laden</strong><br>
      Quelle: <code>${file}</code><br>
      ${esc(String(err))}<br><br>
      Prüfe, ob die Datei im Repo existiert: 
      <a href="${blob}" target="_blank" rel="noopener">Auf GitHub öffnen</a>`;
    document.title = 'QUESTSYSTEM – 404';
  });
})();
</script>
</body>
</html>
