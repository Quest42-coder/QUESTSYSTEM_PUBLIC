<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QUESTSYSTEM ‚Äì Ring-Homepage</title>
<style>
  :root{ --bg:#0e1116; --fg:#e7eef7; --muted:#9fb0c6; --ring-inner:#f3c0c7; --ring-mid:#f0de94; --ring-outer:#bcd5ff; --node-bg:#10151f; --node-border:#2a3344; --focus:#66ccff; --shadow:0 6px 24px rgba(0,0,0,.35) }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0; font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--fg);
       background: radial-gradient(1200px 800px at 50% 40%, #131824 0%, #0c0f16 60%, #090b11 100%);}
  header{position:fixed; inset:16px 16px auto 16px; z-index:30; display:flex; gap:14px; align-items:center;
         padding:10px 14px; background:rgba(10,13,20,.6); border:1px solid #222a39; border-radius:12px; backdrop-filter: blur(6px); box-shadow:var(--shadow)}
  header a{color:var(--fg); text-decoration:none}
  .stage{position:fixed; inset:0; display:grid; place-items:center; padding:16px}
  svg{width:min(1200px,95vw); height:min(900px,90vh)}
  .ring-inner{stroke:var(--ring-inner); stroke-width:2.2; fill:none; stroke-opacity:.9}
  .ring-mid{stroke:var(--ring-mid); stroke-width:2.2; fill:none; stroke-opacity:.9}
  .ring-outer{stroke:var(--ring-outer); stroke-width:2.2; fill:none; stroke-opacity:.9}

  /* ‚Äî‚Äî‚Äî gr√∂√üere Schrift f√ºr Modul-Labels ‚Äî‚Äî‚Äî */
  .node text{
    font-size:15px;              /* +3pt */
    letter-spacing:.3px;
    text-anchor:middle;
    dominant-baseline:middle;
  }
  @media (min-width: 900px){
    .node text{ font-size:16px; } /* auf gro√üen Screens etwas gr√∂√üer */
  }

  .node circle{ fill:var(--node-bg); stroke:var(--node-border); stroke-width:1.5 }
  .inner text{ fill:#5d2029 } .mid text{ fill:#6c5b00 } .outer text{ fill:#274b7a }

  /* RESETBOX-Stile */
  .center circle{ fill:transparent; stroke:#59657c; stroke-dasharray:4 6 }
  .center text{ fill:#7f8ea8; font-weight:600; font-size:14px } /* zentriert + gr√∂√üer */

  .debug{position:fixed; left:16px; bottom:16px; right:16px; z-index:50; background:#1a2233; border:1px solid #2b3548; color:#ffe0e0; padding:10px 12px; border-radius:10px; font-size:13px; box-shadow:var(--shadow); display:none; white-space:pre-wrap}
  .listwrap{position:fixed; left:16px; right:16px; bottom:16px; z-index:20; background:rgba(10,13,20,.7); border:1px solid #222a39; border-radius:12px; padding:10px 12px; max-height:32vh; overflow:auto}
  .listwrap a{color:#9ad1ff; text-decoration:none; margin-right:10px}
</style>
</head>
<body>
  <header>
    <strong>üçÑ QUESTSYSTEM ‚Äì Modul-Ringe</strong>
    <span style="flex:1"></span>
    <a id="nav-dignity">Dignity Clause</a>
    <a id="nav-gebote">14 Gebote</a>
    <a id="nav-discuss">Diskussion</a>
    <a href="https://github.com/Quest42-coder/QUESTSYSTEM_PUBLIC" target="_blank" rel="noopener">Repo</a>
  </header>

  <div class="stage">
    <svg id="ringmap" viewBox="-600 -600 1200 1200" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" role="img" aria-label="Konzentrische Modul-Ringe">
      <circle class="ring-inner" r="220"></circle>
      <circle class="ring-mid"   r="380"></circle>
      <circle class="ring-outer" r="540"></circle>

      <!-- RESETBOX: Text exakt zentriert + klickbar via Script (id="reset") -->
      <g id="reset" class="center">
        <circle r="70"></circle>
        <text x="0" y="0" text-anchor="middle" dominant-baseline="middle">RESETBOX</text>
      </g>
    </svg>
  </div>

  <!-- Fallback-Linkliste (immer klickbar) -->
  <div id="list" class="listwrap"></div>

  <!-- Sichtbares Debug-Panel bei Fehlern -->
  <div id="dbg" class="debug"></div>

<script>
(function(){
  // ===== Basics
  const svg = document.getElementById('ringmap');
  const dbg = document.getElementById('dbg');
  const list = document.getElementById('list');

  const BASE = (()=>{ const u=new URL(location.href); if(u.pathname.endsWith('index.html')) u.pathname=u.pathname.replace(/index\.html$/,''); if(!u.pathname.endsWith('/')) u.pathname+='/'; return u.origin+u.pathname; })();
  const V    = 'ui-tune1'; // Cache-Bust
  const urlFor = (p) => `${BASE}module.html?file=${encodeURIComponent(p)}&v=${encodeURIComponent(V)}`;

  // Header-Links
  document.getElementById('nav-dignity').href = urlFor('MODULES/DIGNITY_CLAUSE.md');
  document.getElementById('nav-gebote').href  = urlFor('MODULES/14_GEBOTE_V2.1.md');
  document.getElementById('nav-discuss').href = urlFor('MODULES/14_GEBOTE_DISCUSSION.md');

  // ===== Nodes (vollst√§ndig)
  const nodes = [
    // INNER
    {label:"WATER",ring:"inner",file:"MODULES/Modul_02_WATER.md"},
    {label:"SHELTER",ring:"inner",file:"MODULES/Modul_03_SHELTER.md"},
    {label:"FOOD",ring:"inner",file:"MODULES/Modul_04_FOOD.md"},
    {label:"SLEEP",ring:"inner",file:"MODULES/Modul_05_SLEEP.md"},
    {label:"BODY",ring:"inner",file:"MODULES/Modul_06_BODY.md"},
    {label:"PSYCHE",ring:"inner",file:"MODULES/Modul_07_PSYCHE.md"},
    {label:"DEVICE",ring:"inner",file:"MODULES/Modul_08_DEVICE.md"},
    {label:"DEBT",ring:"inner",file:"MODULES/Modul_09_DEBT.md"},
    // MID
    {label:"WORK",ring:"mid",file:"MODULES/Modul_10_WORK.md"},
    {label:"SCHOOL",ring:"mid",file:"MODULES/Modul_11_SCHOOL.md"},
    {label:"BORDER",ring:"mid",file:"MODULES/Modul_12_BORDER.md"},
    {label:"NATURE",ring:"mid",file:"MODULES/Modul_13_NATURE.md"},
    {label:"HEALTH",ring:"mid",file:"MODULES/Modul_14_HEALTH.md"},
    {label:"CARE",ring:"mid",file:"MODULES/Modul_15_CARE.md"},
    {label:"FAMILY",ring:"mid",file:"MODULES/Modul_16_FAMILY.md"},
    {label:"ANIMAL",ring:"mid",file:"MODULES/Modul_17_ANIMAL.md"},
    {label:"CULTURE",ring:"mid",file:"MODULES/Modul_18_CULTURE.md"},
    {label:"MEDIA",ring:"mid",file:"MODULES/Modul_19_MEDIA.md"},
    {label:"ENERGY",ring:"mid",file:"MODULES/Modul_20_ENERGY.md"},
    {label:"CLIMATE",ring:"mid",file:"MODULES/Modul_21_CLIMATE.md"},
    {label:"MIGRATION",ring:"mid",file:"MODULES/Modul_22_MIGRATION.md"},
    {label:"JUSTICE",ring:"mid",file:"MODULES/Modul_23_JUSTICE.md"},
    {label:"COMMUNITY",ring:"mid",file:"MODULES/Modul_24_COMMUNITY.md"},
    // OUTER
    {label:"HOUSING",ring:"outer",file:"MODULES/Modul_26_HOUSING.md"},
    {label:"TRANSPORT",ring:"outer",file:"MODULES/Modul_27_TRANSPORT.md"},
    {label:"NETWORK",ring:"outer",file:"MODULES/Modul_28_NETWORK.md"},
    {label:"SYMBOL",ring:"outer",file:"MODULES/Modul_29_SYMBOL.md"},
    {label:"TRUTH",ring:"outer",file:"MODULES/Modul_30_TRUTH.md"},
    {label:"MEMORY",ring:"outer",file:"MODULES/Modul_31_MEMORY.md"},
    {label:"LICENCE",ring:"outer",file:"MODULES/Modul_32_LICENCE.md"},
    {label:"PRIVACY",ring:"outer",file:"MODULES/Modul_33_PRIVACY.md"},
    {label:"DATA",ring:"outer",file:"MODULES/Modul_34_DATA.md"},
    {label:"CONFLICT",ring:"outer",file:"MODULES/Modul_35_CONFLICT.md"},
    {label:"DEMOCRACY",ring:"outer",file:"MODULES/Modul_37_DEMOCRACY.md"},
    {label:"KNOWLEDGE",ring:"outer",file:"MODULES/Modul_39_KNOWLEDGE.md"},
    {label:"ART",ring:"outer",file:"MODULES/Modul_40_ART.md"},
    {label:"FUTURE",ring:"outer",file:"MODULES/Modul_41_FUTURE.md"},
    {label:"DEATH",ring:"outer",file:"MODULES/Modul_42_DEATH.md"}
  ];

  // ===== Fallback-Linkliste (immer!)
  list.innerHTML = nodes.map(n => `<a href="${urlFor(n.file)}">${n.label}</a>`).join(' ¬∑ ');

  // ===== Placement
  const config = { inner:{r:220,class:"inner"}, mid:{r:380,class:"mid"}, outer:{r:540,class:"outer"} };
  const SVG_NS   = "http://www.w3.org/2000/svg";
  const XLINK_NS = "http://www.w3.org/1999/xlink";

  function showError(msg, err){
    dbg.style.display='block';
    dbg.textContent = `[FEHLER] ${msg}\n` + (err && err.stack ? err.stack : (err || ''));
  }

  function placeNodes(){
    try{
      if (!svg) throw new Error('SVG nicht gefunden');
      if (!Array.isArray(nodes) || nodes.length===0) throw new Error('nodes[] leer');

      const groups = {inner:[], mid:[], outer:[]};
      nodes.forEach(n=>{ if(!groups[n.ring]) groups[n.ring]=[]; groups[n.ring].push(n); });

      Object.entries(groups).forEach(([ring,list])=>{
        const radius = (config[ring]||{}).r; if(!radius) return;
        const group  = document.createElementNS(SVG_NS,"g");
        group.setAttribute("class", (config[ring]||{}).class || '');
        svg.appendChild(group);

        const step  = (Math.PI*2)/list.length;
        const start = (-Math.PI/2);

        list.forEach((n,idx)=>{
          const angle = start + idx*step;
          const x = Math.cos(angle)*radius;
          const y = Math.sin(angle)*radius;
          const url = urlFor(n.file);

          const a = document.createElementNS(SVG_NS,"a");
          a.setAttribute("href", url);
          a.setAttributeNS(XLINK_NS, "xlink:href", url);
          a.setAttribute("target","_self");
          a.setAttribute("transform",`translate(${x},${y})`);
          a.classList.add("node",(config[ring]||{}).class||'');

          // Klick erzwingen (auch iOS/Opera)
          const go = () => { try{ window.location.assign(url); } catch(e){ location.href=url; } };
          a.addEventListener('click',   e=>{ e.preventDefault(); go(); });
          a.addEventListener('touchend',e=>{ e.preventDefault(); go(); }, {passive:false});
          a.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); go(); }});
          a.setAttribute('tabindex','0'); a.setAttribute('role','link'); a.setAttribute('focusable','true');
          a.setAttribute('aria-label', `${n.label} ‚Äì √∂ffnen`);

          const circle=document.createElementNS(SVG_NS,"circle"); circle.setAttribute("r",44); a.appendChild(circle);
          const text=document.createElementNS(SVG_NS,"text"); text.textContent=n.label; a.appendChild(text);

          group.appendChild(a);
        });
      });

      console.log(`Nodes gerendert: ${nodes.length}`);
    }catch(err){ showError('placeNodes()', err); }
  }

  placeNodes();

  // ===== RESETBOX klickbar machen (√∂ffnet README.md in module.html)
  (function makeResetboxClickable(){
    const reset = document.getElementById('reset');
    if(!reset) return;

    const url = `${BASE}module.html?file=${encodeURIComponent('README.md')}&v=${encodeURIComponent(V)}`;

    reset.style.cursor = 'pointer';
    reset.setAttribute('tabindex','0');
    reset.setAttribute('role','link');
    reset.setAttribute('focusable','true');
    reset.setAttribute('aria-label','RESETBOX ‚Äì README √∂ffnen');

    const go = () => { try{ window.location.assign(url); } catch(e){ location.href = url; } };

    reset.addEventListener('click',   e => { e.preventDefault(); go(); });
    reset.addEventListener('touchend',e => { e.preventDefault(); go(); }, {passive:false});
    reset.addEventListener('keydown', e => { if (e.key==='Enter'||e.key===' ') { e.preventDefault(); go(); }});

    // Optional: Tooltip-Hook (falls vorhanden)
    if (typeof showTip === 'function'){
      reset.addEventListener('mouseenter', e => showTip('RESETBOX', e));
      reset.addEventListener('mousemove',  e => (typeof moveTip==='function') && moveTip(e));
      reset.addEventListener('mouseleave', () => (typeof hideTip==='function') && hideTip());
    }
  })();
})();
</script>
</body>
</html>
