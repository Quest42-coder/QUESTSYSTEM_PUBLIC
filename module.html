<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QUESTSYSTEM ‚Äì Modulansicht</title>
  <meta name="description" content="QUESTSYSTEM Modulansicht ‚Äì l√§dt Module direkt von raw.githubusercontent.com" />
  <style>
    :root{ --bg:#0b0f16; --fg:#e7eef7; --muted:#9fb0c6; --link:#9ad1ff; --border:#243047; --card:#0f1521; }
    body{margin:0; font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--fg); background:var(--bg);}
    header{padding:12px 16px; background:#111624; border-bottom:1px solid var(--border);}
    header strong{margin-right:12px;}
    header a{color:var(--link); margin-right:12px; text-decoration:none;}
    main{max-width:900px; margin:30px auto; padding:0 16px;}
    #title{margin:0 0 12px 0;}
    #content a{color:var(--link);}
    .err{color:#ffb0b0;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
</head>
<body>
  <header>
    <strong>üçÑ QUESTSYSTEM</strong>
    <a href="./index.html">Ring-√úbersicht</a>
    <a id="view-raw" target="_blank" rel="noopener">Raw</a>
    <a id="view-github" target="_blank" rel="noopener">GitHub</a>
  </header>

  <main>
    <h1 id="title">Modul wird geladen ‚Ä¶</h1>
    <div><code id="src"></code></div>
    <article id="content"></article>
  </main>

  <script>
    const OWNER="Quest42-coder";
    const REPO="QUESTSYSTEM_PUBLIC";
    const BRANCH="main"; // ‚ö†Ô∏è falls dein Repo "master" nutzt, hier √§ndern!

    const qs = new URLSearchParams(location.search);
    const file = qs.get("file");

    const srcEl = document.getElementById("src");
    const titleEl = document.getElementById("title");
    const contentEl = document.getElementById("content");
    const aRaw = document.getElementById("view-raw");
    const aGH  = document.getElementById("view-github");

    if(!file){
      titleEl.textContent = "Kein Modul angegeben";
      contentEl.innerHTML = `<p class="err">Verwende ?file=MODULES/Modul_XX_NAME.md</p>`;
    } else {
      const path = file.replace(/^\.?\//,'');
      const rawUrl = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${path}`;
      const ghUrl  = `https://github.com/${OWNER}/${REPO}/blob/${BRANCH}/${path}`;

      srcEl.textContent = path;
      aRaw.href = rawUrl;
      aGH.href  = ghUrl;

      fetch(rawUrl, {cache:'no-store'})
        .then(r => {
          if(!r.ok) throw new Error(`HTTP ${r.status}`);
          return r.text();
        })
        .then(md => {
          const h1 = md.match(/^#\s+(.+)$/m);
          if(h1) titleEl.textContent = h1[1].trim();
          const html = marked.parse(md, {mangle:false, headerIds:true});
          contentEl.innerHTML = DOMPurify.sanitize(html);
        })
        .catch(err => {
          titleEl.textContent = "Fehler beim Laden";
          contentEl.innerHTML = `<p class="err">Konnte <code>${path}</code> nicht laden: ${err}</p>
            <p>Pr√ºfe den Dateinamen und Branch (${BRANCH}).</p>`;
        });
    }
  </script>
</body>
</html>
