<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QUESTSYSTEM Â· Modul-Karte</title>
  <meta name="description" content="Interaktive Karte des QUESTSYSTEMS: 42 Module in drei Ringen.">
  <style>
    :root{
      --bg:#0b0b0c; --fg:#e9e9ee; --muted:#a7a7b0;
      --red:#e34b4b; --yellow:#e9c64a; --blue:#4b8fe3;
      --edge:#a0a0aa33; --edge-hi:#ffffffaa;
      --card:#131316;
    }
    html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .site-header,.site-footer{padding:14px 20px;border-bottom:1px solid #202026}
    .site-footer{border:0;border-top:1px solid #202026}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    .card{background:var(--card);padding:12px 14px;border:1px solid #202026;border-radius:10px;margin-bottom:16px}
    .map-wrap{position:relative;background:#101013;border:1px solid #202026;border-radius:12px;overflow:hidden}
    #map{display:block;width:100%;height:auto}
    .tooltip{position:absolute;min-width:180px;max-width:280px;background:#0e0e11;border:1px solid #2a2a33;border-radius:10px;padding:10px 12px;box-shadow:0 6px 20px #0008}
    .tooltip h3{margin:0 0 6px 0;font-size:14px}
    .tooltip p{margin:0;color:var(--muted);font-size:12px}
    .label{pointer-events:none;font-size:12px;fill:var(--fg);text-anchor:middle;dominant-baseline:middle}
    .label-bg{fill:#000;fill-opacity:.45;rx:4;ry:4}
    .edge{stroke:var(--edge);stroke-width:2}
    .edge--hi{stroke:var(--edge-hi);stroke-width:2.5}
    .node{cursor:pointer;transition:transform .08s ease}
    .node:hover{transform:scale(1.06)}
    .visually-hidden-focusable{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}
    .visually-hidden-focusable:focus{position:static;width:auto;height:auto;padding:8px 10px;background:#222;border-radius:6px}
  </style>
</head>
<body>
  <a href="#main" class="visually-hidden-focusable">Skip to map</a>

  <header class="site-header">
    <h1>QUESTSYSTEM Â· Modul-Karte</h1>
  </header>

  <main id="main" class="container">
    <section class="card">
      <h2>Ãœber die Karte</h2>
      <p>
        Desktop: mit der Maus Ã¼ber ein Modul fahren zeigt VerknÃ¼pfungen.  
        Mobile: Tippen zeigt/verbirgt VerknÃ¼pfungen. Klick Ã¶ffnet die Detailseite.
      </p>
    </section>

    <div class="map-wrap">
      <svg id="map" viewBox="0 0 1200 900" role="img" aria-label="QUESTSYSTEM Modulkarte">
        <desc>Interaktive Karte lÃ¤dt â€¦ Wenn nichts erscheint, bitte neu laden oder Verbindung prÃ¼fen.</desc>
      </svg>
      <div id="tooltip" class="tooltip" hidden></div>
    </div>
  </main>

  <footer class="site-footer">
    <small>Â© QUESTSYSTEM Â· Lizenz: CC BY-SA 4.0 + Dignity Clause Â· Ringe: ðŸ”´ Existential Â· ðŸŸ¡ Societal Â· ðŸ”µ Structural</small>
  </footer>

  <script>
 <script>
document.addEventListener('DOMContentLoaded', function(){
  // harte Radien â€“ unabhÃ¤ngig von CSS-Variablen
  const RS={inner:56, mid:56, outer:56, center:96};
  const R ={inner:220, mid:380, outer:540, center:0};
  const SVG_NS="http://www.w3.org/2000/svg", XLINK_NS="http://www.w3.org/1999/xlink";

  const svg=document.getElementById('map');
  const nodesLayer=document.getElementById('nodes-layer');
  const labelsLayer=document.getElementById('labels-layer');
  const linksLayer=document.getElementById('links-layer');
  const tip=document.getElementById('tip');

  if(!svg||!nodesLayer||!labelsLayer||!linksLayer){ console.warn('QS: Layer fehlen'); return; }

  // Module â€“ komplette Liste
  const MODS = [
    {no:"01",id:"RESETBOX", ring:"center", file:"MODULES/Modul_01_RESETBOX.md"},
    {no:"02",id:"WATER",    ring:"inner",  file:"MODULES/Modul_02_WATER.md"},
    {no:"03",id:"SHELTER",  ring:"inner",  file:"MODULES/Modul_03_SHELTER.md"},
    {no:"04",id:"FOOD",     ring:"inner",  file:"MODULES/Modul_04_FOOD.md"},
    {no:"05",id:"SLEEP",    ring:"inner",  file:"MODULES/Modul_05_SLEEP.md"},
    {no:"06",id:"BODY",     ring:"inner",  file:"MODULES/Modul_06_BODY.md"},
    {no:"07",id:"PSYCHE",   ring:"inner",  file:"MODULES/Modul_07_PSYCHE.md"},
    {no:"08",id:"DEVICE",   ring:"inner",  file:"MODULES/Modul_08_DEVICE.md"},
    {no:"09",id:"DEBT",     ring:"inner",  file:"MODULES/Modul_09_DEBT.md"},
    {no:"10",id:"WORK",     ring:"mid",    file:"MODULES/Modul_10_WORK.md"},
    {no:"11",id:"SCHOOL",   ring:"mid",    file:"MODULES/Modul_11_SCHOOL.md"},
    {no:"12",id:"BORDER",   ring:"mid",    file:"MODULES/Modul_12_BORDER.md"},
    {no:"13",id:"NATURE",   ring:"mid",    file:"MODULES/Modul_13_NATURE.md"},
    {no:"14",id:"HEALTH",   ring:"mid",    file:"MODULES/Modul_14_HEALTH.md"},
    {no:"15",id:"CARE",     ring:"mid",    file:"MODULES/Modul_15_CARE.md"},
    {no:"16",id:"FAMILY",   ring:"mid",    file:"MODULES/Modul_16_FAMILY.md"},
    {no:"17",id:"ANIMAL",   ring:"mid",    file:"MODULES/Modul_17_ANIMAL.md"},
    {no:"18",id:"CULTURE",  ring:"mid",    file:"MODULES/Modul_18_CULTURE.md"},
    {no:"19",id:"MEDIA",    ring:"mid",    file:"MODULES/Modul_19_MEDIA.md"},
    {no:"20",id:"ENERGY",   ring:"mid",    file:"MODULES/Modul_20_ENERGY.md"},
    {no:"21",id:"CLIMATE",  ring:"mid",    file:"MODULES/Modul_21_CLIMATE.md"},
    {no:"22",id:"MIGRATION",ring:"mid",    file:"MODULES/Modul_22_MIGRATION.md"},
    {no:"23",id:"JUSTICE",  ring:"mid",    file:"MODULES/Modul_23_JUSTICE.md"},
    {no:"24",id:"COMMUNITY",ring:"mid",    file:"MODULES/Modul_24_COMMUNITY.md"},
    {no:"25",id:"FINANCE",  ring:"outer",  file:"MODULES/Modul_25_FINANCE.md"},
    {no:"26",id:"HOUSING",  ring:"outer",  file:"MODULES/Modul_26_HOUSING.md"},
    {no:"27",id:"TRANSPORT",ring:"outer",  file:"MODULES/Modul_27_TRANSPORT.md"},
    {no:"28",id:"NETWORK",  ring:"outer",  file:"MODULES/Modul_28_NETWORK.md"},
    {no:"29",id:"SYMBOL",   ring:"outer",  file:"MODULES/Modul_29_SYMBOL.md"},
    {no:"30",id:"TRUTH",    ring:"outer",  file:"MODULES/Modul_30_TRUTH.md"},
    {no:"31",id:"MEMORY",   ring:"outer",  file:"MODULES/Modul_31_MEMORY.md"},
    {no:"32",id:"LICENCE",  ring:"outer",  file:"MODULES/Modul_32_LICENCE.md"},
    {no:"33",id:"PRIVACY",  ring:"outer",  file:"MODULES/Modul_33_PRIVACY.md"},
    {no:"34",id:"SECURITY", ring:"outer",  file:"MODULES/Modul_34_SECURITY.md"},
    {no:"35",id:"DATA",     ring:"outer",  file:"MODULES/Modul_35_DATA.md"},
    {no:"36",id:"CONFLICT", ring:"outer",  file:"MODULES/Modul_36_CONFLICT.md"},
    {no:"37",id:"DEMOCRACY",ring:"outer",  file:"MODULES/Modul_37_DEMOCRACY.md"},
    {no:"38",id:"GOVERNANCE",ring:"outer", file:"MODULES/Modul_38_GOVERNANCE.md"},
    {no:"39",id:"KNOWLEDGE", ring:"outer", file:"MODULES/Modul_39_KNOWLEDGE.md"},
    {no:"40",id:"ART",       ring:"outer", file:"MODULES/Modul_40_ART.md"},
    {no:"41",id:"FUTURE",    ring:"outer", file:"MODULES/Modul_41_FUTURE.md"},
    {no:"42",id:"DEATH",     ring:"outer", file:"MODULES/Modul_42_DEATH.md"}
  ];

  // CORE-VerknÃ¼pfungen
  const CORE = {
    "01:RESETBOX":["02:WATER","03:SHELTER","09:DEBT"],
    "02:WATER":["04:FOOD","06:BODY","13:NATURE"],
    "03:SHELTER":["05:SLEEP","13:NATURE","01:RESETBOX"],
    "04:FOOD":["02:WATER","13:NATURE","25:FINANCE"],
    "05:SLEEP":["03:SHELTER","07:PSYCHE","06:BODY"],
    "06:BODY":["02:WATER","05:SLEEP","07:PSYCHE"],
    "07:PSYCHE":["05:SLEEP","06:BODY","30:TRUTH"],
    "08:DEVICE":["20:ENERGY","32:LICENCE","01:RESETBOX"],
    "09:DEBT":["10:WORK","25:FINANCE","01:RESETBOX"],
    "10:WORK":["09:DEBT","11:SCHOOL","25:FINANCE"],
    "11:SCHOOL":["10:WORK","30:TRUTH","07:PSYCHE"],
    "12:BORDER":["01:RESETBOX","13:NATURE","36:CONFLICT"],
    "13:NATURE":["02:WATER","04:FOOD","20:ENERGY"],
    "14:HEALTH":["02:WATER","06:BODY","07:PSYCHE"],
    "15:CARE":["14:HEALTH","07:PSYCHE","01:RESETBOX"],
    "16:FAMILY":["05:SLEEP","11:SCHOOL","14:HEALTH"],
    "17:ANIMAL":["04:FOOD","13:NATURE","14:HEALTH"],
    "18:CULTURE":["11:SCHOOL","30:TRUTH","29:SYMBOL"],
    "19:MEDIA":["30:TRUTH","32:LICENCE","11:SCHOOL"],
    "20:ENERGY":["08:DEVICE","13:NATURE","25:FINANCE"],
    "21:CLIMATE":["13:NATURE","20:ENERGY","14:HEALTH"],
    "22:MIGRATION":["12:BORDER","13:NATURE","36:CONFLICT"],
    "23:JUSTICE":["09:DEBT","10:WORK","32:LICENCE"],
    "24:COMMUNITY":["11:SCHOOL","18:CULTURE","23:JUSTICE"],
    "25:FINANCE":["09:DEBT","10:WORK","20:ENERGY"],
    "26:HOUSING":["03:SHELTER","05:SLEEP","25:FINANCE"],
    "27:TRANSPORT":["02:WATER","20:ENERGY","22:MIGRATION"],
    "28:NETWORK":["08:DEVICE","20:ENERGY","19:MEDIA"],
    "29:SYMBOL":["18:CULTURE","24:COMMUNITY","30:TRUTH"],
    "30:TRUTH":["11:SCHOOL","19:MEDIA","32:LICENCE"],
    "31:MEMORY":["11:SCHOOL","29:SYMBOL","30:TRUTH"],
    "32:LICENCE":["19:MEDIA","30:TRUTH","08:DEVICE"],
    "33:PRIVACY":["08:DEVICE","19:MEDIA","32:LICENCE"],
    "34:SECURITY":["01:RESETBOX","12:BORDER","36:CONFLICT"],
    "35:DATA":["08:DEVICE","28:NETWORK","32:LICENCE"],
    "36:CONFLICT":["12:BORDER","22:MIGRATION","34:SECURITY"],
    "37:DEMOCRACY":["23:JUSTICE","24:COMMUNITY","25:FINANCE"],
    "38:GOVERNANCE":["23:JUSTICE","37:DEMOCRACY","25:FINANCE"],
    "39:KNOWLEDGE":["11:SCHOOL","30:TRUTH","31:MEMORY"],
    "40:ART":["18:CULTURE","29:SYMBOL","39:KNOWLEDGE"],
    "41:FUTURE":["21:CLIMATE","39:KNOWLEDGE","40:ART"],
    "42:DEATH":["14:HEALTH","15:CARE","41:FUTURE"]
  };

  // bidirektionaler Link-Index
  const LINKS = new Map();
  Object.keys(CORE).forEach(k=>{
    const a = k.split(':')[1];
    if(!LINKS.has(a)) LINKS.set(a,new Set());
    CORE[k].forEach(bk=>{
      const b=bk.split(':')[1];
      if(!LINKS.has(b)) LINKS.set(b,new Set());
      LINKS.get(a).add(b); LINKS.get(b).add(a);
    });
  });

  // Helpers
  const polar = (r,a)=>[Math.cos(a)*r, Math.sin(a)*r];
  const distributeAngles = n => Array.from({length:n},(_,i)=> -Math.PI/2 + i*(2*Math.PI/n));
  const nodeCenterPos = el => {
    const m=(el.getAttribute('transform')||'').match(/translate\(([-\d.]+),([-\d.]+)\)/);
    return m?{x:+m[1],y:+m[2]}:{x:0,y:0};
  };
  const curve = (pA,pB)=>{
    const mid={x:(pA.x+pB.x)/2, y:(pA.y+pB.y)/2};
    const c  ={x:mid.x+mid.x*0.08, y:mid.y+mid.y*0.08};
    return `M ${pA.x} ${pA.y} Q ${c.x} ${c.y} ${pB.x} ${pB.y}`;
  };
  const urlFor = (file)=>{
    const u=new URL(location.href);
    if(u.pathname.endsWith('map.html')) u.pathname = u.pathname.replace(/map\.html$/,'');
    if(!u.pathname.endsWith('/')) u.pathname+='/';
    return u.origin + u.pathname + 'module.html?file=' + encodeURIComponent(file);
  };

  function addNodeEvents(a, mod){
    const show=(e)=>{ tip.innerHTML=`${mod.no} ${mod.id}<br><small>Ã–ffnen</small>`; tip.style.left=e.clientX+'px'; tip.style.top=e.clientY+'px'; tip.classList.add('show'); highlight(mod.id); };
    const move=(e)=>{ tip.style.left=e.clientX+'px'; tip.style.top=e.clientY+'px'; };
    const hide=()=>{ tip.classList.remove('show'); clearHighlight(); };
    a.addEventListener('mouseenter', show);
    a.addEventListener('mousemove', move);
    a.addEventListener('mouseleave', hide);
  }

  function addLabel(mod, ring, angle, r){
    const offset = ring==='inner'? 86 : ring==='mid'? 96 : 104;
    const [lx,ly] = polar(r+offset, angle);
    const g=document.createElementNS(SVG_NS,'g');
    g.setAttribute('transform',`translate(${lx},${ly})`);
    g.setAttribute('class','label'); g.dataset.id=mod.id;

    const rect=document.createElementNS(SVG_NS,'rect');
    const text=document.createElementNS(SVG_NS,'text');
    text.textContent=`${mod.no} ${mod.id}`;
    text.setAttribute('dominant-baseline','middle');
    const deg=angle*180/Math.PI;
    if(ring==='center'){ text.setAttribute('text-anchor','middle'); text.setAttribute('x',0); }
    else if(deg>-90 && deg<=90){ text.setAttribute('text-anchor','start'); text.setAttribute('x',14); }
    else{ text.setAttribute('text-anchor','end'); text.setAttribute('x',-14); }
    text.setAttribute('y',0);

    g.appendChild(rect); g.appendChild(text); labelsLayer.appendChild(g);
    requestAnimationFrame(()=>{ const bb=text.getBBox(); rect.setAttribute('x',bb.x-10); rect.setAttribute('y',bb.y-8); rect.setAttribute('width',bb.width+20); rect.setAttribute('height',bb.height+16); });
  }

  function addNode(mod, ring, angle, r){
    const [x,y]=polar(r,angle);
    const a=document.createElementNS(SVG_NS,'a');
    a.classList.add('node',ring);
    const href=urlFor(mod.file);
    a.setAttribute('href',href);
    a.setAttributeNS(XLINK_NS,'xlink:href',href);
    a.setAttribute('transform',`translate(${x},${y})`);
    a.dataset.id=mod.id;

    const glow=document.createElementNS(SVG_NS,'circle'); glow.setAttribute('class','glow'); glow.setAttribute('r',RS[ring]); a.appendChild(glow);
    const c=document.createElementNS(SVG_NS,'circle'); c.setAttribute('r',RS[ring]); a.appendChild(c);

    addNodeEvents(a,mod);
    nodesLayer.appendChild(a);
    addLabel(mod, ring, angle, r);
  }

  function dimAll(on){
    document.querySelectorAll('a.node').forEach(n=>n.style.opacity=on?.25:1);
    labelsLayer.querySelectorAll('.label').forEach(l=>l.style.opacity=on?.28:1);
  }
  function clearPaths(){ while(linksLayer.firstChild) linksLayer.removeChild(linksLayer.firstChild); }

  function highlight(id){
    clearPaths();
    const nodesAll=[...document.querySelectorAll('a.node')];
    const active=nodesAll.find(n=>n.dataset.id===id);
    const targets = LINKS.get(id)? Array.from(LINKS.get(id)) : [];
    if(!active || !targets.length){ dimAll(false); return; }

    dimAll(true); active.style.opacity=1;
    targets.forEach(t=>{ const el=nodesAll.find(n=>n.dataset.id===t); if(el) el.style.opacity=1; });

    const pA=nodeCenterPos(active);
    targets.forEach(t=>{
      const el=nodesAll.find(n=>n.dataset.id===t); if(!el) return;
      const pB=nodeCenterPos(el);
      const path=document.createElementNS(SVG_NS,'path');
      path.setAttribute('d', curve(pA,pB));
      linksLayer.appendChild(path);
    });
    linksLayer.classList.add('visible');
  }
  function clearHighlight(){
    clearPaths();
    linksLayer.classList.remove('visible');
    dimAll(false);
  }

  // Build
  (function build(){
    const center=MODS.find(m=>m.ring==='center'); if(center) addNode(center,'center',0,0);
    ['inner','mid','outer'].forEach(r=>{
      const list=MODS.filter(m=>m.ring===r);
      const ang = distributeAngles(list.length);
      list.forEach((m,i)=>addNode(m, r, ang[i], R[r]));
    });
    // kleines Diagnose-Badge
    const b=document.createElement('div');
    b.style.cssText='position:fixed;left:10px;bottom:10px;background:#222;color:#fff;border-radius:8px;padding:6px 8px;font:12px ui-monospace,monospace;z-index:9';
    b.textContent='nodes='+document.querySelectorAll("a.node").length+' | labels='+document.querySelectorAll(".label").length;
    document.body.appendChild(b);
  })();
});
</script> 
</body>
</html>
