<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QUESTSYSTEM ‚Äì Modul-Ringe</title>
<meta name="description" content="QUESTSYSTEM ‚Äì √úbersicht aller Module als konzentrische Ringe. Hover zeigt Verbindungen. Klick √∂ffnet Modulbeschreibung." />
<style>
  :root{
    --bg:#0e1116; --fg:#e7eef7; --muted:#9fb0c6;
    --inner:#f3c0c7; --mid:#f0de94; --outer:#bcd5ff;
    --edge:#8fb3ff; --edge-strong:#66ccff;
    --node-border:#2a3344; --node-hover:#4a5d80;
    --cut:#0c1018; --header-h:56px; --glass:rgba(12,16,24,.6); --border:#222a39;
    --shadow: 0 10px 30px rgba(0,0,0,.45);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--fg);
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:
      radial-gradient(1200px 800px at 50% 45%, #141a2a 0%, #0f1422 60%, var(--bg) 100%),
      radial-gradient(800px 600px at 20% 10%, rgba(255,255,255,.04), transparent 60%),
      radial-gradient(700px 700px at 80% 80%, rgba(255,255,255,.03), transparent 65%);
    overflow:hidden;
  }

  /* ===== Header ===== */
  .qs-header{
    position:fixed; top:0; left:0; right:0; height:var(--header-h); z-index:60;
    display:flex; align-items:center; gap:12px; padding:10px 14px;
    background:var(--glass); border-bottom:1px solid var(--border); backdrop-filter:blur(8px);
  }
  .qs-logo{ color:var(--fg); font-weight:900; letter-spacing:.4px; text-decoration:none; }
  .qs-nav{ margin-left:auto; display:flex; gap:10px; align-items:center; }
  .qs-dd{ position:relative; }
  .qs-dd-btn{
    color:var(--fg); background:transparent; border:1px solid transparent;
    padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:600;
  }
  .qs-dd-btn:focus{ outline:2px solid var(--edge-strong); outline-offset:2px; }
  .qs-dd-menu{
    position:absolute; right:0; top:calc(100% + 6px); min-width:240px; max-height:60vh; overflow:auto;
    display:none; flex-direction:column; gap:4px; padding:8px;
    background:rgba(10,13,20,.97); border:1px solid var(--border); border-radius:10px; box-shadow:var(--shadow);
  }
  .qs-dd:hover .qs-dd-menu{ display:flex; }
  .qs-dd-menu a{ color:var(--fg); text-decoration:none; padding:8px 10px; border-radius:6px; white-space:nowrap; }
  .qs-dd-menu a:hover{ background:rgba(255,255,255,.06); }

  .qs-burger{ display:none; background:none; border:0; width:38px; height:38px; margin-left:auto; cursor:pointer; }
  .qs-burger span{ display:block; height:2px; background:var(--fg); margin:7px 5px; border-radius:2px; }

  @media (max-width:900px){
    .qs-burger{ display:block; }
    .qs-nav{ position:fixed; top:var(--header-h); left:10px; right:10px; display:none; flex-direction:column; gap:12px;
             background:rgba(10,13,20,.98); border:1px solid var(--border); border-radius:12px; padding:12px; z-index:65; }
    .qs-dd{ width:100%; }
    .qs-dd-btn{ width:100%; text-align:left; border:1px solid var(--border); border-radius:10px; }
    .qs-dd-menu{ position:static; display:block; max-height:none; overflow:visible; background:transparent; border:0; box-shadow:none; padding:6px 0; }
    .qs-dd:hover .qs-dd-menu{ display:block; }
  }

  /* ===== B√ºhne / SVG ===== */
  .stage{ position:absolute; inset:var(--header-h) 0 0 0; display:grid; place-items:center; padding:8px; }
  svg{ width:min(1400px,96vw); height:min(1400px,96vh); }

  /* Ringe */
  .ring{ fill:none; stroke-width:3; opacity:.95; filter: drop-shadow(0 3px 12px rgba(0,0,0,.35)); }
  .ring-inner{ stroke:var(--inner) } .ring-mid{ stroke:var(--mid) } .ring-outer{ stroke:var(--outer) }

  /* Kanten (einmal gezeichnet, Sichtbarkeit via Klasse) */
  .edges path{
    stroke:var(--edge); stroke-width:2.4; fill:none; opacity:0;
    vector-effect:non-scaling-stroke; transition:opacity .12s ease, stroke-width .12s ease, stroke .12s ease;
    will-change: opacity;
  }
  .edges path.on{ opacity:.98; stroke:var(--edge-strong); stroke-width:3.4; }

  /* Nodes (durchbrechen Ring sichtbar via ‚Äûcut‚Äú) */
  .node{ filter: drop-shadow(0 6px 20px rgba(0,0,0,.45)); transition: transform .12s ease; }
  .node .cut{ fill:var(--cut); }
  .node .rim{ fill:transparent; stroke:var(--node-border); stroke-width:2.2; }
  .node .hit{ fill:rgba(255,255,255,0); cursor:pointer; pointer-events:all; } /* volle Klickfl√§che */
  .node:hover{ transform: translateY(-2px) scale(1.03); }
  .node:hover .rim{ stroke:var(--node-hover); }

  .node:focus-within .rim{ stroke:var(--edge-strong); stroke-width:3; } /* Tastatur-Fokus sichtbar */

  /* Labels ‚Äì gro√ü, mit ‚ÄûOutline‚Äú */
  .node text{
    font-weight:1000; letter-spacing:.38px;
    text-anchor:middle; dominant-baseline:middle; pointer-events:none;
    paint-order: stroke; stroke:rgba(12,16,24,.7); stroke-width:2.4;
    filter: drop-shadow(0 1px 0 rgba(0,0,0,.35));
  }
  .inner text{ fill:#571e28 } .mid text{ fill:#6c5b00 } .outer text{ fill:#23436a }
  .inner text,.mid text,.outer text{ font-size:26px; }
  @media (min-width:1100px){ .inner text,.mid text,.outer text{ font-size:28px; } }
  @media (min-width:1300px){ .inner text,.mid text,.outer text{ font-size:30px; } }

  /* RESETBOX im Zentrum */
  .center .cut{ fill:var(--cut); }
  .center .rim{ fill:transparent; stroke:#9cb5da; stroke-dasharray:7 10; stroke-width:3.2; }
  .center text{
    fill:#ffffff; font-weight:1000; font-size:76px; letter-spacing:1px;
    text-anchor:middle; dominant-baseline:middle;
    paint-order: stroke; stroke:rgba(12,16,24,.75); stroke-width:3;
    filter: drop-shadow(0 3px 0 rgba(0,0,0,.35));
  }
  .center .hit{ fill:rgba(255,255,255,0); cursor:pointer; }

  /* Tooltip */
  .tip{
    position:fixed; z-index:70; pointer-events:none;
    background:#0f1624; border:1px solid #2b3548; color:var(--fg);
    padding:8px 10px; border-radius:8px; font-size:12px; white-space:nowrap;
    opacity:0; transform:translate(-50%,-140%); transition:opacity .12s ease, transform .12s ease;
    box-shadow: var(--shadow);
  }
  .tip.show{ opacity:1; transform:translate(-50%,-150%); }
</style>
</head>
<body>

<!-- Header -->
<header class="qs-header" role="navigation" aria-label="Hauptnavigation">
  <a class="qs-logo" href="./">üçÑ QUESTSYSTEM</a>
  <button class="qs-burger" aria-label="Men√º √∂ffnen/schlie√üen" aria-expanded="false"><span></span><span></span><span></span></button>
  <nav class="qs-nav">
    <div class="qs-dd">
      <button class="qs-dd-btn" aria-haspopup="true" aria-expanded="false">System</button>
      <div class="qs-dd-menu">
        <a href="./index.html">Modul-Map</a>
        <a href="module.html?file=MODULES/Modul_01_RESETBOX.md">01 RESETBOX</a>
      </div>
    </div>
    <div class="qs-dd">
      <button class="qs-dd-btn" aria-haspopup="true" aria-expanded="false">Dokumente</button>
      <div class="qs-dd-menu">
        <a href="module.html?file=Dignity_Clause.md">Dignity Clause</a>
        <a href="module.html?file=14_GEBOTE_V2.1.md">14 Gebote (V2.1)</a>
        <a href="module.html?file=MODULES/14_GEBOTE_DISCUSSION.md">Diskussion</a>
        <a href="module.html?file=MODULES/Modul_32_LICENCE.md">Licence</a>
      </div>
    </div>
    <div class="qs-dd">
      <button class="qs-dd-btn" aria-haspopup="true" aria-expanded="false">Kritikfelder</button>
      <div class="qs-dd-menu">
        <a href="module.html?file=CRITIQUE/RESETBOX_HIGHRISK.md">High-Risk</a>
        <a href="module.html?file=CRITIQUE/RESETBOX_MEDIUMRISK.md">Medium-Risk</a>
        <a href="module.html?file=CRITIQUE/RESETBOX_LOWRISK.md">Low-Risk</a>
      </div>
    </div>
    <div class="qs-dd">
      <button class="qs-dd-btn" aria-haspopup="true" aria-expanded="false">Module</button>
      <div class="qs-dd-menu">
        <!-- kompakte Liste ‚Äì alle 42 -->
        <a href="module.html?file=MODULES/Modul_02_WATER.md">02 WATER</a>
        <a href="module.html?file=MODULES/Modul_03_SHELTER.md">03 SHELTER</a>
        <a href="module.html?file=MODULES/Modul_04_FOOD.md">04 FOOD</a>
        <a href="module.html?file=MODULES/Modul_05_SLEEP.md">05 SLEEP</a>
        <a href="module.html?file=MODULES/Modul_06_BODY.md">06 BODY</a>
        <a href="module.html?file=MODULES/Modul_07_PSYCHE.md">07 PSYCHE</a>
        <a href="module.html?file=MODULES/Modul_08_DEVICE.md">08 DEVICE</a>
        <a href="module.html?file=MODULES/Modul_09_DEBT.md">09 DEBT</a>
        <a href="module.html?file=MODULES/Modul_10_WORK.md">10 WORK</a>
        <a href="module.html?file=MODULES/Modul_11_SCHOOL.md">11 SCHOOL</a>
        <a href="module.html?file=MODULES/Modul_12_BORDER.md">12 BORDER</a>
        <a href="module.html?file=MODULES/Modul_13_NATURE.md">13 NATURE</a>
        <a href="module.html?file=MODULES/Modul_14_HEALTH.md">14 HEALTH</a>
        <a href="module.html?file=MODULES/Modul_15_CARE.md">15 CARE</a>
        <a href="module.html?file=MODULES/Modul_16_FAMILY.md">16 FAMILY</a>
        <a href="module.html?file=MODULES/Modul_17_ANIMAL.md">17 ANIMAL</a>
        <a href="module.html?file=MODULES/Modul_18_CULTURE.md">18 CULTURE</a>
        <a href="module.html?file=MODULES/Modul_19_MEDIA.md">19 MEDIA</a>
        <a href="module.html?file=MODULES/Modul_20_ENERGY.md">20 ENERGY</a>
        <a href="module.html?file=MODULES/Modul_21_CLIMATE.md">21 CLIMATE</a>
        <a href="module.html?file=MODULES/Modul_22_MIGRATION.md">22 MIGRATION</a>
        <a href="module.html?file=MODULES/Modul_23_JUSTICE.md">23 JUSTICE</a>
        <a href="module.html?file=MODULES/Modul_24_COMMUNITY.md">24 COMMUNITY</a>
        <a href="module.html?file=MODULES/Modul_25_FINANCE.md">25 FINANCE</a>
        <a href="module.html?file=MODULES/Modul_26_HOUSING.md">26 HOUSING</a>
        <a href="module.html?file=MODULES/Modul_27_TRANSPORT.md">27 TRANSPORT</a>
        <a href="module.html?file=MODULES/Modul_28_NETWORK.md">28 NETWORK</a>
        <a href="module.html?file=MODULES/Modul_29_SYMBOL.md">29 SYMBOL</a>
        <a href="module.html?file=MODULES/Modul_30_TRUTH.md">30 TRUTH</a>
        <a href="module.html?file=MODULES/Modul_31_MEMORY.md">31 MEMORY</a>
        <a href="module.html?file=MODULES/Modul_32_LICENCE.md">32 LICENCE</a>
        <a href="module.html?file=MODULES/Modul_33_PRIVACY.md">33 PRIVACY</a>
        <a href="module.html?file=MODULES/Modul_34_SECURITY.md">34 SECURITY</a>
        <a href="module.html?file=MODULES/Modul_35_DATA.md">35 DATA</a>
        <a href="module.html?file=MODULES/Modul_36_CONFLICT.md">36 CONFLICT</a>
        <a href="module.html?file=MODULES/Modul_37_DEMOCRACY.md">37 DEMOCRACY</a>
        <a href="module.html?file=MODULES/Modul_38_GOVERNANCE.md">38 GOVERNANCE</a>
        <a href="module.html?file=MODULES/Modul_39_KNOWLEDGE.md">39 KNOWLEDGE</a>
        <a href="module.html?file=MODULES/Modul_40_ART.md">40 ART</a>
        <a href="module.html?file=MODULES/Modul_41_FUTURE.md">41 FUTURE</a>
        <a href="module.html?file=MODULES/Modul_42_DEATH.md">42 DEATH</a>
      </div>
    </div>
    <div class="qs-dd">
      <button class="qs-dd-btn" aria-haspopup="true" aria-expanded="false">Info</button>
      <div class="qs-dd-menu">
        <a href="module.html?file=README.md">README</a>
        <a href="module.html?file=MODULES/ARTIST_PROFILE.md">Artist Profile</a>
        <a href="https://github.com/Quest42-coder/QUESTSYSTEM_PUBLIC" target="_blank" rel="noopener">GitHub</a>
      </div>
    </div>
  </nav>
</header>

<!-- B√ºhne -->
<div class="stage">
  <svg id="ringmap" viewBox="-600 -600 1200 1200"
       xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
       role="img" aria-label="Konzentrische Modul-Ringe des QUESTSYSTEMS">
    <g class="edges" id="edges"></g>

    <circle class="ring ring-inner" r="220"></circle>
    <circle class="ring ring-mid"   r="380"></circle>
    <circle class="ring ring-outer" r="540"></circle>

    <!-- RESETBOX zentral -->
    <a class="node-anchor"
       xlink:href="module.html?file=MODULES/Modul_01_RESETBOX.md"
       href="module.html?file=MODULES/Modul_01_RESETBOX.md">
      <g class="center" transform="translate(0,0)" tabindex="0" data-id="01" aria-label="01 RESETBOX">
        <circle class="cut" r="175"></circle>
        <circle class="rim" r="175"></circle>
        <text y="6">RESETBOX</text>
        <circle class="hit" r="175"></circle>
      </g>
    </a>
  </svg>
</div>

<div id="tip" class="tip" role="status" aria-live="polite"></div>

<script>
/* ===== Mobile Header Toggle ===== */
(function(){
  const burger = document.querySelector('.qs-burger');
  const nav = document.querySelector('.qs-nav');
  if(!burger || !nav) return;
  burger.addEventListener('click', ()=>{
    const open = nav.style.display === 'flex';
    nav.style.display = open ? 'none' : 'flex';
    burger.setAttribute('aria-expanded', String(!open));
  });
  nav.addEventListener('click', (e)=>{
    const a = e.target.closest('a');
    if(a && window.matchMedia('(max-width: 900px)').matches){
      nav.style.display = 'none';
      burger.setAttribute('aria-expanded','false');
    }
  });
})();

/* ===== Daten ===== */
const MODS = [
  {no:"01", label:"RESETBOX", ring:"center", file:"MODULES/Modul_01_RESETBOX.md"},
  {no:"02", label:"WATER",    ring:"inner", file:"MODULES/Modul_02_WATER.md"},
  {no:"03", label:"SHELTER",  ring:"inner", file:"MODULES/Modul_03_SHELTER.md"},
  {no:"04", label:"FOOD",     ring:"inner", file:"MODULES/Modul_04_FOOD.md"},
  {no:"05", label:"SLEEP",    ring:"inner", file:"MODULES/Modul_05_SLEEP.md"},
  {no:"06", label:"BODY",     ring:"inner", file:"MODULES/Modul_06_BODY.md"},
  {no:"07", label:"PSYCHE",   ring:"inner", file:"MODULES/Modul_07_PSYCHE.md"},
  {no:"08", label:"DEVICE",   ring:"inner", file:"MODULES/Modul_08_DEVICE.md"},
  {no:"09", label:"DEBT",     ring:"inner", file:"MODULES/Modul_09_DEBT.md"},

  {no:"10", label:"WORK",      ring:"mid",   file:"MODULES/Modul_10_WORK.md"},
  {no:"11", label:"SCHOOL",    ring:"mid",   file:"MODULES/Modul_11_SCHOOL.md"},
  {no:"12", label:"BORDER",    ring:"mid",   file:"MODULES/Modul_12_BORDER.md"},
  {no:"13", label:"NATURE",    ring:"mid",   file:"MODULES/Modul_13_NATURE.md"},
  {no:"14", label:"HEALTH",    ring:"mid",   file:"MODULES/Modul_14_HEALTH.md"},
  {no:"15", label:"CARE",      ring:"mid",   file:"MODULES/Modul_15_CARE.md"},
  {no:"16", label:"FAMILY",    ring:"mid",   file:"MODULES/Modul_16_FAMILY.md"},
  {no:"17", label:"ANIMAL",    ring:"mid",   file:"MODULES/Modul_17_ANIMAL.md"},
  {no:"18", label:"CULTURE",   ring:"mid",   file:"MODULES/Modul_18_CULTURE.md"},
  {no:"19", label:"MEDIA",     ring:"mid",   file:"MODULES/Modul_19_MEDIA.md"},
  {no:"20", label:"ENERGY",    ring:"mid",   file:"MODULES/Modul_20_ENERGY.md"},
  {no:"21", label:"CLIMATE",   ring:"mid",   file:"MODULES/Modul_21_CLIMATE.md"},
  {no:"22", label:"MIGRATION", ring:"mid",   file:"MODULES/Modul_22_MIGRATION.md"},
  {no:"23", label:"JUSTICE",   ring:"mid",   file:"MODULES/Modul_23_JUSTICE.md"},
  {no:"24", label:"COMMUNITY", ring:"mid",   file:"MODULES/Modul_24_COMMUNITY.md"},

  {no:"25", label:"FINANCE",   ring:"outer", file:"MODULES/Modul_25_FINANCE.md"},
  {no:"26", label:"HOUSING",   ring:"outer", file:"MODULES/Modul_26_HOUSING.md"},
  {no:"27", label:"TRANSPORT", ring:"outer", file:"MODULES/Modul_27_TRANSPORT.md"},
  {no:"28", label:"NETWORK",   ring:"outer", file:"MODULES/Modul_28_NETWORK.md"},
  {no:"29", label:"SYMBOL",    ring:"outer", file:"MODULES/Modul_29_SYMBOL.md"},
  {no:"30", label:"TRUTH",     ring:"outer", file:"MODULES/Modul_30_TRUTH.md"},
  {no:"31", label:"MEMORY",    ring:"outer", file:"MODULES/Modul_31_MEMORY.md"},
  {no:"32", label:"LICENCE",   ring:"outer", file:"MODULES/Modul_32_LICENCE.md"},
  {no:"33", label:"PRIVACY",   ring:"outer", file:"MODULES/Modul_33_PRIVACY.md"},
  {no:"34", label:"SECURITY",  ring:"outer", file:"MODULES/Modul_34_SECURITY.md"},
  {no:"35", label:"DATA",      ring:"outer", file:"MODULES/Modul_35_DATA.md"},
  {no:"36", label:"CONFLICT",  ring:"outer", file:"MODULES/Modul_36_CONFLICT.md"},
  {no:"37", label:"DEMOCRACY", ring:"outer", file:"MODULES/Modul_37_DEMOCRACY.md"},
  {no:"38", label:"GOVERNANCE",ring:"outer", file:"MODULES/Modul_38_GOVERNANCE.md"},
  {no:"39", label:"KNOWLEDGE", ring:"outer", file:"MODULES/Modul_39_KNOWLEDGE.md"},
  {no:"40", label:"ART",       ring:"outer", file:"MODULES/Modul_40_ART.md"},
  {no:"41", label:"FUTURE",    ring:"outer", file:"MODULES/Modul_41_FUTURE.md"},
  {no:"42", label:"DEATH",     ring:"outer", file:"MODULES/Modul_42_DEATH.md"}
];

const LINKS = {
  "01":["02","03","09"],
  "02":["04","06","13"],
  "03":["05","13","01"],
  "04":["02","13","25"],
  "05":["03","07","06"],
  "06":["02","05","07"],
  "07":["05","06","30"],
  "08":["20","32","01"],
  "09":["10","25","01"],
  "10":["09","11","25"],
  "11":["10","30","07"],
  "12":["01","13","36"],
  "13":["02","04","20"],
  "14":["02","06","07"],
  "15":["14","07","01"],
  "16":["05","11","14"],
  "17":["04","13","14"],
  "18":["11","30","29"],
  "19":["30","32","11"],
  "20":["08","13","25"],
  "21":["13","20","14"],
  "22":["12","13","36"],
  "23":["09","10","32"],
  "24":["11","18","23"],
  "25":["09","10","20"],
  "26":["03","05","25"],
  "27":["02","20","22"],
  "28":["08","20","19"],
  "29":["18","24","30"],
  "30":["11","19","32"],
  "31":["11","29","30"],
  "32":["19","30","08"],
  "33":["08","19","32"],
  "34":["01","12","36"],
  "35":["08","28","32"],
  "36":["12","22","34"],
  "37":["23","24","25"],
  "38":["23","37","25"],
  "39":["11","30","31"],
  "40":["18","29","39"],
  "41":["21","39","40"],
  "42":["14","15","41"]
};

/* ===== SVG & Layout ===== */
const svg = document.getElementById('ringmap');
const edgesLayer = document.getElementById('edges');
const tip = document.getElementById('tip');

const groups = {inner:[], mid:[], outer:[]};
MODS.forEach(m=>{ if(m.ring!=="center") groups[m.ring].push(m); });
const cfg = { inner:{r:220}, mid:{r:380}, outer:{r:540} };
const pos = { "01": {x:0, y:0} }; // Resetbox im Kern

const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
function showTip(text, e){
  tip.textContent = text;
  const x = clamp(e.clientX, 10, window.innerWidth-10);
  const y = clamp(e.clientY, 10, window.innerHeight-10);
  tip.style.left = x+'px'; tip.style.top = y+'px'; tip.classList.add('show');
}
const hideTip = ()=> tip.classList.remove('show');

function clearEdges(){ edgesLayer.querySelectorAll('.on').forEach(p=>p.classList.remove('on')); }
function edgesFor(no){ return edgesLayer.querySelectorAll(`path[data-a="${no}"], path[data-b="${no}"]`); }
function highlight(no, on){ edgesFor(no).forEach(p=>p.classList.toggle('on', !!on)); }

/* --- robustes Label-Fitting (verhindert NaN & Crashes) --- */
function fitLabel(textEl, R){
  let fsAttr = textEl.getAttribute('font-size');
  let fs = parseFloat(fsAttr || 28);
  if (!fs || Number.isNaN(fs)) fs = 28;
  const maxW = 1.65 * R;
  textEl.setAttribute('font-size', fs);
  let bb;
  try { bb = textEl.getBBox(); } catch { return; }
  if (!bb || !isFinite(bb.width)) return;
  while (bb.width > maxW && fs > 16){
    fs -= 1;
    textEl.setAttribute('font-size', fs);
    try { bb = textEl.getBBox(); } catch { break; }
    if (!bb || !isFinite(bb.width)) break;
  }
}

/* --- Nodes platzieren (leicht nach au√üen = Durchbruch-Effekt) --- */
Object.entries(groups).forEach(([ring, list])=>{
  if (!list || !list.length) return;
  const radius = cfg[ring].r + 8;
  const step = (Math.PI*2)/list.length;
  const start = -Math.PI/2;

  list.forEach((m, idx)=>{
    const ang = start + idx*step;
    const x = Math.cos(ang)*radius;
    const y = Math.sin(ang)*radius;
    pos[m.no] = {x,y};

    const a = document.createElementNS("http://www.w3.org/2000/svg","a");
    const url = "module.html?file="+encodeURIComponent(m.file);
    a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",url);
    a.setAttribute("href",url);
    a.setAttribute("class","node-anchor");

    const g = document.createElementNS("http://www.w3.org/2000/svg","g");
    g.setAttribute("class","node "+ring);
    g.setAttribute("transform",`translate(${x},${y})`);
    g.setAttribute("tabindex","0");
    g.dataset.id = m.no;
    g.setAttribute("aria-label", `${m.no} ${m.label}`);

    const R = ring==='outer'?70 : (ring==='mid'?66 : 64);
    const cut = document.createElementNS("http://www.w3.org/2000/svg","circle");
    const rim = document.createElementNS("http://www.w3.org/2000/svg","circle");
    const hit = document.createElementNS("http://www.w3.org/2000/svg","circle");
    cut.setAttribute('r', R); cut.setAttribute('class','cut');
    rim.setAttribute('r', R); rim.setAttribute('class','rim');
    hit.setAttribute('r', R); hit.setAttribute('class','hit');

    const t = document.createElementNS("http://www.w3.org/2000/svg","text");
    t.textContent = m.no+" "+m.label;

    g.appendChild(cut); g.appendChild(rim); g.appendChild(hit); g.appendChild(t);
    a.appendChild(g);
    svg.appendChild(a);

    fitLabel(t, R);
  });
});

/* --- Kanten einmal zeichnen (Bezier-leichte Kr√ºmmung) --- */
(function drawEdges(){
  const done = {};
  Object.keys(LINKS).forEach(a=>{
    LINKS[a].forEach(b=>{
      const key = (a<b)?`${a}-${b}`:`${b}-${a}`;
      if(done[key]) return; done[key]=1;
      const A = pos[a], B = pos[b]; if(!A||!B) return;
      const mx=(A.x+B.x)/2, my=(A.y+B.y)/2, k=0.12, nx=(B.y-A.y), ny=-(B.x-A.x);
      const cx=mx+nx*k, cy=my+ny*k;
      const p=document.createElementNS("http://www.w3.org/2000/svg","path");
      p.setAttribute('d',`M ${A.x} ${A.y} Q ${cx} ${cy} ${B.x} ${B.y}`);
      p.setAttribute('data-a',a); p.setAttribute('data-b',b);
      edgesLayer.appendChild(p);
    });
  });
})();

/* --- Hover/Fokus: Verbindungen stabil, solange √ºber dem Modul --- */
let active = null;
function labelFor(id){
  if(id==="01") return "01 RESETBOX";
  const m = MODS.find(x=>x.no===id); return m ? `${m.no} ${m.label}` : id;
}
function setActive(id, evt){
  if(active === id){
    if(evt) showTip(labelFor(id), evt);
    return;
  }
  active = id;
  clearEdges();
  if(id){ highlight(id, true); if(evt) showTip(labelFor(id), evt); }
  else { hideTip(); }
}

(function bindAnchors(){
  const anchors = document.querySelectorAll('a.node-anchor');
  anchors.forEach(a => {
    const g = a.querySelector('[data-id]');
    if(!g) return;
    const id = g.dataset.id;

    const enter = e => setActive(id, e);
    const move  = e => showTip(labelFor(id), e);
    const leave = () => { if(active === id) setActive(null); };

    // Stabil & kompatibel
    a.addEventListener('pointerenter', enter);
    a.addEventListener('pointermove',  move);
    a.addEventListener('pointerleave', leave);
    a.addEventListener('mouseenter',   enter);  // Safari-Fallback
    a.addEventListener('mousemove',    move);
    a.addEventListener('mouseleave',   leave);

    // Tastatur
    g.addEventListener('focusin',  e => setActive(id, e));
    g.addEventListener('focusout', () => { if(active === id) setActive(null); });

    // Touch: 1. Tap = zeigen, 2. Tap = √∂ffnen
    a.addEventListener('click', (e)=>{
      if(active !== id){
        setActive(id, e);
        e.preventDefault();
      }
    }, {capture:true});
  });

  // Verl√§sst der Pointer die SVG ‚Üí aus
  svg.addEventListener('pointerleave', ()=> setActive(null));
  svg.addEventListener('mouseleave',   ()=> setActive(null));
})();
</script>
</body>
</html>
