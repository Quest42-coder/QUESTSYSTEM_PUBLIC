<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QUESTSYSTEM ‚Äì Module & Ringe</title>
  <meta name="description" content="√úbersicht aller QUESTSYSTEM-Module als konzentrische Ringe. Klickbar, mit Verbindungen, Suchliste, Tastatur-Navigation." />
  <meta name="color-scheme" content="dark">
  <style>
    :root{
      --bg:#0d1117; --fg:#e6eef7; --muted:#9fb0c6;
      --ring-inner:#f3c0c7; --ring-mid:#f0de94; --ring-outer:#bcd5ff;
      --edge:#8fb3ff; --edge-dim:#6f849f;
      --hit-stroke:#2a3344;
      --focus:#66ccff;
      --shade: rgba(0,0,0,.35);
      --header-h: 56px;
      --font: 16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:var(--font); color:var(--fg);
      background: radial-gradient(1200px 800px at 50% 40%, #141a27 0%, #0e1421 55%, #0b101a 100%);
      overflow:hidden;
    }

    header{
      position:fixed; inset:0 0 auto 0; height:var(--header-h); z-index:30;
      display:flex; align-items:center; gap:12px; padding:8px 14px;
      background:rgba(9,13,20,.85); border-bottom:1px solid #202738; backdrop-filter: blur(6px);
    }
    .brand{display:flex; align-items:center; gap:10px}
    .brand .dot{font-size:16px}
    .brand h1{font-size:14px; margin:0; font-weight:800; letter-spacing:.3px}
    nav{margin-left:auto; display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    nav a, nav summary{color:var(--fg); font-size:13px; text-decoration:none; opacity:.9; cursor:pointer}
    nav a:hover{opacity:1; text-decoration:underline}
    details.dropdown{position:relative}
    details[open] summary{opacity:1; text-decoration:underline}
    .menu{
      position:absolute; right:0; top:calc(100% + 6px); min-width:260px; max-height:60vh; overflow:auto;
      background:#0f1624; border:1px solid #223047; border-radius:10px; padding:10px; box-shadow:0 12px 40px var(--shade); z-index:40;
    }
    .menu h4{margin:6px 6px 4px; font-size:12px; color:#9fb0c6; letter-spacing:.3px}
    .menu a{display:block; padding:6px 8px; border-radius:6px}
    .menu a:hover{background:#142035; text-decoration:none}

    .stage{position:absolute; inset: var(--header-h) 0 0 0; display:grid; place-items:center; padding:12px;}
    svg{width:min(1200px, 96vw); height:calc(96vh - var(--header-h));}

    .ring-inner{stroke:var(--ring-inner); stroke-width:2.2; fill:none; stroke-opacity:.9}
    .ring-mid{stroke:var(--ring-mid); stroke-width:2.2; fill:none; stroke-opacity:.9}
    .ring-outer{stroke:var(--ring-outer); stroke-width:2.2; fill:none; stroke-opacity:.9}

    .edges path{
      stroke:var(--edge); stroke-width:2; fill:none; opacity:.45;
      transition:opacity .12s ease, stroke-width .12s ease, stroke .12s ease;
      vector-effect:non-scaling-stroke;
    }
    svg.hovering .edges path{ opacity:.2; stroke:var(--edge-dim) }
    .edges path.on{ opacity:.98; stroke-width:3.2; stroke:var(--edge) }

    svg a.node{ cursor:pointer; filter: drop-shadow(0 2px 8px var(--shade)); transition: transform .12s ease; outline:none; }
    svg a.node:hover{ transform: translateY(-2px) scale(1.03); }
    .node .hit{
      /* r wird per JS gesetzt! */
      fill:rgba(255,255,255,0.001);
      stroke:var(--hit-stroke); stroke-width:1.5; vector-effect:non-scaling-stroke;
      pointer-events:visiblePainted;
    }
    .node:focus .hit{ outline: none; stroke: var(--focus); stroke-width:2.2 }
    .node text{
      font-size:12px; letter-spacing:.3px; text-anchor:middle; dominant-baseline:middle; pointer-events:none
    }
    .inner text{ fill:#5d2029 } .mid text{ fill:#6c5b00 } .outer text{ fill:#274b7a }
    .node.linked text{ font-weight:800 }

    .center circle{ fill:transparent; stroke:#8aa2c6; stroke-dasharray:4 6; stroke-width:2 }
    .center text{ fill:#ffffff; font-weight:900; font-size:30px; letter-spacing:.6px; text-anchor:middle; dominant-baseline:middle; pointer-events:none; }
    .center:focus circle{ stroke:var(--focus); stroke-width:2.2; outline:none }

    .tip{
      position:fixed; z-index:40; pointer-events:none;
      transform:translate(-50%, calc(-100% - 12px));
      background:#0f1624; border:1px solid #2b3548; color:var(--fg);
      padding:8px 10px; border-radius:8px; font-size:12px; white-space:nowrap;
      opacity:0; transition:opacity .12s ease, transform .12s ease; box-shadow:0 8px 24px var(--shade);
    }
    .tip.show{opacity:1; transform:translate(-50%, calc(-100% - 10px))}
    .tip small{color:var(--muted)}

    .legend{
      position:fixed; inset:auto 14px 14px 14px; z-index:25;
      display:flex; gap:10px; align-items:center; justify-content:center;
      background:rgba(12,16,24,.55); border:1px solid #202738; border-radius:10px; padding:8px 10px; backdrop-filter: blur(6px);
      font-size:12px;
    }
    .chip{display:inline-flex; align-items:center; gap:8px}
    .sw{width:14px; height:14px; border-radius:50%}
    .sw.inner{background:var(--ring-inner)} .sw.mid{background:var(--ring-mid)} .sw.outer{background:var(--ring-outer)}

    @media (prefers-reduced-motion: reduce){
      svg a.node:hover{ transform:none }
      .edges path, .tip{ transition:none }
    }
    @media (max-width:720px){
      .brand h1{display:none}
      nav summary, nav a{font-size:12px}
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="dot">üçÑ</div>
      <h1>QUESTSYSTEM ‚Äì Modul-Ringe</h1>
    </div>
    <nav>
      <a href="https://github.com/Quest42-coder/QUESTSYSTEM_PUBLIC" target="_blank" rel="noopener">Repository</a>
      <a id="nav-dignity">Dignity Clause</a>
      <a id="nav-gebote">14 Gebote</a>
      <a id="nav-discuss">Diskussion</a>
      <details class="dropdown">
        <summary>Module</summary>
        <div class="menu" id="menu-mods" role="menu" aria-label="Modulliste"></div>
      </details>
    </nav>
  </header>

  <div class="stage">
    <svg id="ringmap" viewBox="-600 -600 1200 1200"
         xmlns="http://www.w3.org/2000/svg"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         role="img" aria-label="Konzentrische Modul-Ringe des QUESTSYSTEMS">

      <circle class="ring-inner" r="220"></circle>
      <circle class="ring-mid"   r="380"></circle>
      <circle class="ring-outer" r="540"></circle>

      <g id="edges" class="edges" aria-hidden="true"></g>

      <!-- RESETBOX: fix r als Zahl -->
      <a class="center" id="center-reset" target="_self" tabindex="0" aria-label="RESETBOX √∂ffnen">
        <g><circle r="140"></circle><text y="0">RESETBOX</text></g>
      </a>
    </svg>
  </div>

  <div class="legend" aria-hidden="true">
    <span class="chip"><span class="sw inner"></span>Existential</span>
    <span class="chip"><span class="sw mid"></span>Societal</span>
    <span class="chip"><span class="sw outer"></span>Structural</span>
  </div>

  <div id="tip" class="tip" role="status" aria-live="polite"></div>

  <script>
    // ---- Konstante Radien f√ºr JS (statt CSS) ----
    const NODE_HIT_R = 56;

    // ---- Basis-URL ----
    const BASE = (()=>{
      const u=new URL(window.location.href);
      if(u.pathname.endsWith('index.html')) u.pathname=u.pathname.replace(/index\.html$/,'');
      if(!u.pathname.endsWith('/')) u.pathname+='/';
      return u.origin+u.pathname;
    })();
    const urlFor = (p)=> `${BASE}module.html?file=${encodeURIComponent(p)}`;

    // Header-Links
    document.getElementById('nav-dignity').href = urlFor('MODULES/DIGNITY_CLAUSE.md');
    document.getElementById('nav-gebote').href  = urlFor('MODULES/14_GEBOTE_V2.1.md');
    document.getElementById('nav-discuss').href = urlFor('MODULES/14_GEBOTE_DISCUSSION.md');

    // Module
    const MODS = [
      {label:"WATER", ring:"inner", file:"MODULES/Modul_02_WATER.md"},
      {label:"SHELTER", ring:"inner", file:"MODULES/Modul_03_SHELTER.md"},
      {label:"FOOD", ring:"inner", file:"MODULES/Modul_04_FOOD.md"},
      {label:"SLEEP", ring:"inner", file:"MODULES/Modul_05_SLEEP.md"},
      {label:"BODY", ring:"inner", file:"MODULES/Modul_06_BODY.md"},
      {label:"PSYCHE", ring:"inner", file:"MODULES/Modul_07_PSYCHE.md"},
      {label:"DEVICE", ring:"inner", file:"MODULES/Modul_08_DEVICE.md"},
      {label:"DEBT", ring:"inner", file:"MODULES/Modul_09_DEBT.md"},
      {label:"WORK", ring:"mid", file:"MODULES/Modul_10_WORK.md"},
      {label:"SCHOOL", ring:"mid", file:"MODULES/Modul_11_SCHOOL.md"},
      {label:"BORDER", ring:"mid", file:"MODULES/Modul_12_BORDER.md"},
      {label:"NATURE", ring:"mid", file:"MODULES/Modul_13_NATURE.md"},
      {label:"HEALTH", ring:"mid", file:"MODULES/Modul_14_HEALTH.md"},
      {label:"CARE", ring:"mid", file:"MODULES/Modul_15_CARE.md"},
      {label:"FAMILY", ring:"mid", file:"MODULES/Modul_16_FAMILY.md"},
      {label:"ANIMAL", ring:"mid", file:"MODULES/Modul_17_ANIMAL.md"},
      {label:"CULTURE", ring:"mid", file:"MODULES/Modul_18_CULTURE.md"},
      {label:"MEDIA", ring:"mid", file:"MODULES/Modul_19_MEDIA.md"},
      {label:"ENERGY", ring:"mid", file:"MODULES/Modul_20_ENERGY.md"},
      {label:"CLIMATE", ring:"mid", file:"MODULES/Modul_21_CLIMATE.md"},
      {label:"MIGRATION", ring:"mid", file:"MODULES/Modul_22_MIGRATION.md"},
      {label:"JUSTICE", ring:"mid", file:"MODULES/Modul_23_JUSTICE.md"},
      {label:"COMMUNITY", ring:"mid", file:"MODULES/Modul_24_COMMUNITY.md"},
      {label:"HOUSING", ring:"outer", file:"MODULES/Modul_26_HOUSING.md"},
      {label:"TRANSPORT", ring:"outer", file:"MODULES/Modul_27_TRANSPORT.md"},
      {label:"NETWORK", ring:"outer", file:"MODULES/Modul_28_NETWORK.md"},
      {label:"SYMBOL", ring:"outer", file:"MODULES/Modul_29_SYMBOL.md"},
      {label:"TRUTH", ring:"outer", file:"MODULES/Modul_30_TRUTH.md"},
      {label:"MEMORY", ring:"outer", file:"MODULES/Modul_31_MEMORY.md"},
      {label:"LICENCE", ring:"outer", file:"MODULES/Modul_32_LICENCE.md"},
      {label:"PRIVACY", ring:"outer", file:"MODULES/Modul_33_PRIVACY.md"},
      {label:"DATA", ring:"outer", file:"MODULES/Modul_34_DATA.md"},
      {label:"CONFLICT", ring:"outer", file:"MODULES/Modul_35_CONFLICT.md"},
      {label:"DEMOCRACY", ring:"outer", file:"MODULES/Modul_37_DEMOCRACY.md"},
      {label:"KNOWLEDGE", ring:"outer", file:"MODULES/Modul_39_KNOWLEDGE.md"},
      {label:"ART", ring:"outer", file:"MODULES/Modul_40_ART.md"},
      {label:"FUTURE", ring:"outer", file:"MODULES/Modul_41_FUTURE.md"},
      {label:"DEATH", ring:"outer", file:"MODULES/Modul_42_DEATH.md"}
    ];

    const EDGES = [
      ["WATER","FOOD"],["WATER","HEALTH"],["WATER","BODY"],
      ["SHELTER","HOUSING"],["SHELTER","COMMUNITY"],
      ["SLEEP","HEALTH"],["SLEEP","PSYCHE"],
      ["BODY","HEALTH"],["PSYCHE","FAMILY"],
      ["DEVICE","DATA"],["DEVICE","PRIVACY"],
      ["DEBT","WORK"],
      ["WORK","SCHOOL"],["WORK","DEBT"],["SCHOOL","KNOWLEDGE"],
      ["BORDER","MIGRATION"],["NATURE","CLIMATE"],
      ["HEALTH","CARE"],["FAMILY","CARE"],["COMMUNITY","JUSTICE"],
      ["CULTURE","ART"],["MEDIA","TRUTH"],["ENERGY","CLIMATE"],
      ["JUSTICE","DEMOCRACY"],["COMMUNITY","FAMILY"],
      ["ART","CULTURE"],["FUTURE","SCHOOL"],["FUTURE","KNOWLEDGE"],
      ["DEATH","HEALTH"],["DEATH","PSYCHE"],
      ["HOUSING","SHELTER"],["TRANSPORT","NETWORK"],
      ["NETWORK","PRIVACY"],["NETWORK","DATA"],
      ["SYMBOL","CULTURE"],["SYMBOL","TRUTH"],
      ["TRUTH","MEDIA"],["TRUTH","KNOWLEDGE"],
      ["MEMORY","KNOWLEDGE"],["MEMORY","PSYCHE"],
      ["LICENCE","ART"],["LICENCE","DATA"],
      ["PRIVACY","DATA"],["PRIVACY","DEVICE"],
      ["DATA","MEDIA"],["DATA","TRUTH"],
      ["CONFLICT","JUSTICE"],["CONFLICT","BORDER"],["CONFLICT","COMMUNITY"],
      ["DEMOCRACY","JUSTICE"],["DEMOCRACY","MEDIA"],
      ["KNOWLEDGE","SCHOOL"],["KNOWLEDGE","MEMORY"]
    ];

    const SVG_NS="http://www.w3.org/2000/svg";
    const XLINK_NS="http://www.w3.org/1999/xlink";
    const svg=document.getElementById('ringmap');
    const edgesLayer=document.getElementById('edges');
    const tip=document.getElementById('tip');

    const pos={}; const nodeRef={}; const neighbors={};

    // Resetbox-Link
    const resetA=document.getElementById('center-reset');
    const resetURL=urlFor('MODULES/Modul_01_RESETBOX.md');
    resetA.setAttribute('href', resetURL);
    resetA.setAttributeNS(XLINK_NS,'xlink:href', resetURL);
    resetA.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); location.href=resetURL; } });

    function groupByRing(){ return MODS.reduce((a,m)=>{ (a[m.ring] ||= []).push(m); return a; },{}); }

    function placeNodes(){
      const groups=groupByRing();
      const cfg={ inner:{r:220,class:'inner'}, mid:{r:380,class:'mid'}, outer:{r:540,class:'outer'} };

      Object.entries(groups).forEach(([ring,list])=>{
        const radius=cfg[ring].r;
        const g=document.createElementNS(SVG_NS,'g'); g.setAttribute('class',cfg[ring].class); svg.appendChild(g);
        const step=(Math.PI*2)/list.length, start=-Math.PI/2;

        list.forEach((m,idx)=>{
          const ang=start+idx*step, x=Math.cos(ang)*radius, y=Math.sin(ang)*radius;
          pos[m.label]={x,y}; const href=urlFor(m.file);

          const a=document.createElementNS(SVG_NS,'a');
          a.setAttribute('href', href); a.setAttributeNS(XLINK_NS,'xlink:href', href);
          a.setAttribute('target','_self'); a.setAttribute('transform',`translate(${x},${y})`);
          a.classList.add('node',cfg[ring].class); a.dataset.label=m.label; a.setAttribute('tabindex','0');
          nodeRef[m.label]=a;

          // Klick-/Fokus-Kreis: Radius als Attribut setzen (Fix!)
          const hit=document.createElementNS(SVG_NS,'circle'); hit.setAttribute('class','hit'); hit.setAttribute('r', String(NODE_HIT_R)); a.appendChild(hit);

          const txt=document.createElementNS(SVG_NS,'text'); txt.textContent=m.label; a.appendChild(txt);

          a.addEventListener('mouseenter', e=>{ showTip(m.label,e); svg.classList.add('hovering'); highlight(m.label,true); });
          a.addEventListener('mousemove', e=>moveTip(e));
          a.addEventListener('mouseleave', ()=>{ hideTip(); svg.classList.remove('hovering'); highlight(m.label,false); });
          a.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); location.href=href; } });

          g.appendChild(a);
        });
      });
    }

    function buildNeighbors(){
      MODS.forEach(m=>neighbors[m.label]=new Set());
      EDGES.forEach(([a,b])=>{ neighbors[a].add(b); neighbors[b].add(a); });
    }

    function drawEdges(){
      EDGES.forEach(([a,b])=>{
        const pa=pos[a], pb=pos[b]; if(!pa||!pb) return;
        const mx=(pa.x+pb.x)/2, my=(pa.y+pb.y)/2, k=0.12, nx=(pb.y-pa.y), ny=-(pb.x-pa.x);
        const cx=mx+nx*k, cy=my+ny*k;
        const d=`M ${pa.x} ${pa.y} Q ${cx} ${cy} ${pb.x} ${pb.y}`;
        const p=document.createElementNS(SVG_NS,'path'); p.setAttribute('d', d); p.dataset.a=a; p.dataset.b=b; edgesLayer.appendChild(p);
      });
    }

    function highlight(label,on){
      document.querySelectorAll(`.edges path[data-a="${label}"], .edges path[data-b="${label}"]`).forEach(p=>p.classList.toggle('on', on));
      (neighbors[label]||new Set()).forEach(lab=>{ const el=nodeRef[lab]; if(el) el.classList.toggle('linked', on); });
      const self=nodeRef[label]; if(self) self.classList.toggle('linked', on);
    }

    function showTip(label,evt){ tip.innerHTML=`${label}<br><small>√ñffnen</small>`; moveTip(evt); tip.classList.add('show'); }
    function moveTip(evt){ tip.style.left=evt.clientX+'px'; tip.style.top=evt.clientY+'px'; }
    function hideTip(){ tip.classList.remove('show'); }

    // Dropdown bef√ºllen
    (function fillMenu(){
      const byRing = MODS.reduce((acc,m)=>{ (acc[m.ring] ||= []).push(m); return acc; },{});
      const order = ["inner","mid","outer"];
      const title = {inner:"Existential (Innenring)", mid:"Societal (Mittelring)", outer:"Structural (Au√üenring)"};
      const menu=document.getElementById('menu-mods');
      order.forEach(r=>{
        if(!byRing[r]) return;
        const h=document.createElement('h4'); h.textContent=title[r]; menu.appendChild(h);
        byRing[r].forEach(m=>{
          const a=document.createElement('a'); a.href=urlFor(m.file); a.textContent=m.label; a.setAttribute('role','menuitem'); menu.appendChild(a);
        });
      });
      menu.addEventListener('click', ()=>{ const root=menu.closest('details'); if(root) root.open=false; });
    })();

    // Build
    placeNodes();
    buildNeighbors();
    drawEdges();
  </script>
</body>
</html>
