<script>
(async function(){
  const params = new URLSearchParams(location.search);
  const file = params.get('file');
  const target = document.getElementById('content'); // dein Container

  function rawUrl(path){
    // Erzwingt Raw-Fallback vom Default-Branch "main"
    return `https://raw.githubusercontent.com/Quest42-coder/QUESTSYSTEM_PUBLIC/main/${path}`;
  }

  async function fetchText(url){
    const r = await fetch(url, {cache:'no-store'});
    if(!r.ok) throw new Error(`HTTP ${r.status} ${url}`);
    return await r.text();
  }

  if(!file){ target.innerHTML = '<p>Keine Datei angegeben.</p>'; return; }

  // 1) Primär: direkt versuchen (relativ vom Pages-Root)
  const direct = file;
  // 2) Fallback: RAW
  const raw = rawUrl(file);

  let md;
  try { md = await fetchText(direct); }
  catch(e1){
    try { md = await fetchText(raw); }
    catch(e2){
      target.innerHTML = `
        <h3>Fehler beim Laden</h3>
        <p>Quelle: <code>${file}</code></p>
        <p>Konnte die Datei nicht laden (auch Raw-Fallback fehlgeschlagen).</p>
        <p>Prüfe, ob die Datei existiert und der Pfad stimmt.</p>
        <p><a href="https://github.com/Quest42-coder/QUESTSYSTEM_PUBLIC/blob/main/${file}" target="_blank" rel="noopener">Auf GitHub öffnen</a></p>`;
      return;
    }
  }

  // Minimal-Markdown-Render (nur Überschriften/Links/Absatz)
  const html = md
    .replace(/^### (.*)$/gm,'<h3>$1</h3>')
    .replace(/^## (.*)$/gm,'<h2>$1</h2>')
    .replace(/^# (.*)$/gm,'<h1>$1</h1>')
    .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
    .replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>')
    .replace(/\n{2,}/g,'</p><p>')
    .replace(/^\s*$/g,'');
  target.innerHTML = `<p>${html}</p>`;
})();
</script>
