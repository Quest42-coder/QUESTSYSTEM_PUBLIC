<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Modul · QUESTSYSTEM</title>
<style>
  :root{--bg:#0b0b0b;--fg:#f5f5f5;--muted:#9aa4b0;--panel:#111;--link:#4aa3ff}
  html,body{height:100%} body{margin:0;background:var(--bg);color:var(--fg);
    font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header,footer,main{max-width:1000px;margin:0 auto;padding:16px}
  a{color:var(--link);text-decoration:none}
  a:hover{text-decoration:underline}
  .meta{opacity:.85;font-size:.92rem}
  .panel{background:var(--panel);border-radius:12px;padding:18px;box-shadow:0 0 0 1px #1a1a1a}
  pre{white-space:pre-wrap;word-wrap:break-word}
  h1,h2,h3{margin:1.2em 0 .5em}
  code{background:#0f0f0f;padding:0 .25em;border-radius:4px}
  .err{color:#ff6b6b}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<header>
  <a href="./map.html">← Karte</a>
  <div class="meta">Modulansicht · lädt Markdown aus <code>MODULES/…</code></div>
</header>

<main>
  <div id="status" class="muted">Lade …</div>
  <article id="content" class="panel" hidden></article>
  <pre id="raw" class="panel" hidden></pre>
</main>

<footer class="muted">
  © QUESTSYSTEM · CC BY-SA 4.0
</footer>

<script>
function getFileParam(){
  try{
    var qs = new URLSearchParams(location.search);
    if (qs.has('file')) return qs.get('file');
  }catch(e){}
  if (location.hash && location.hash.indexOf('file=')>=0){
    var h = location.hash.replace(/^#/, '');
    var params = new URLSearchParams(h);
    if (params.has('file')) return params.get('file');
  }
  return null;
}
function cleanPath(p){
  try{ p = decodeURIComponent(p); }catch(e){}
  p = (p||'').trim();
  if (!/^MODULES\//i.test(p)) {
    if (!p.includes('/')) p = 'MODULES/' + p;
    else p = 'MODULES/' + p.split('/').pop();
  }
  return p.replace(/\.\./g,'');
}
function md2html(md){
  md = md.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  md = md.replace(/^###### (.*)$/gm,'<h6>$1</h6>')
         .replace(/^##### (.*)$/gm,'<h5>$1</h5>')
         .replace(/^#### (.*)$/gm,'<h4>$1</h4>')
         .replace(/^### (.*)$/gm,'<h3>$1</h3>')
         .replace(/^## (.*)$/gm,'<h2>$1</h2>')
         .replace(/^# (.*)$/gm,'<h1>$1</h1>');
  md = md.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
         .replace(/\*(.+?)\*/g,'<em>$1</em>')
         .replace(/`(.+?)`/g,'<code>$1</code>');
  md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>');
  md = md.replace(/^\s*-\s+(.*)$/gm,'• $1');
  md = md.replace(/\n{2,}/g,'</p><p>');
  return '<p>'+md+'</p>';
}
(function(){
  var status = document.getElementById('status');
  var content = document.getElementById('content');
  var raw = document.getElementById('raw');

  var file = getFileParam();
  if (!file){
    status.innerHTML = '<span class="err">Kein Parameter <code>file</code> gefunden.</span>';
    return;
  }
  var path = cleanPath(file);
  status.textContent = 'Lade: ' + path;

  fetch(path,{cache:'no-store'})
    .then(function(res){ if(!res.ok) throw new Error('HTTP '+res.status+' – '+res.statusText); return res.text(); })
    .then(function(md){
      content.innerHTML = md2html(md);
      content.hidden = false;
      raw.hidden = true;
      status.textContent = path;
      var h1 = md.match(/^#\s*(.+)$/m);
      if(h1) document.title = h1[1] + ' · Modul · QUESTSYSTEM';
    })
    .catch(function(err){
      content.hidden = true;
      raw.hidden = false;
      raw.textContent = 'Fehler beim Laden von '+path+'\n\n'+err.message+'\n\nTipp: Prüfe Groß-/Kleinschreibung & Pfad.';
      status.innerHTML = '<span class="err">Fehler</span> · '+path;
    });
})();
</script>
</body>
</html>
