<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QUESTSYSTEM ‚Äì Modul-Ringe</title>
  <meta name="description" content="Ringe mit klickbaren Modulen & automatisch berechneten inhaltlichen Verbindungen (mit Querstrichen)." />
  <style>
    :root{
      --bg:#0e1116; --fg:#e7eef7; --muted:#9fb0c6;
      --ring-inner:#f3c0c7; --ring-mid:#f0de94; --ring-outer:#bcd5ff;
      --inner-fill:#3a0f18; --mid-fill:#3a3200; --outer-fill:#0f2847;
      --node-border:#2a3344;
      --edge:#8fb3ff; --edge-dim:#6f849f; --tick:#c9dbff;
      --shadow: 0 6px 24px rgba(0,0,0,.35);
      --header-h: 54px;
      --node-r: 50;     /* Sichtkreis (Text) */
      --node-hit-r: 56; /* Klickfl√§che: f√ºllt den ganzen Kreis */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--fg);
      background: radial-gradient(1200px 800px at 50% 40%, #131824 0%, #0c0f16 60%, #090b11 100%);
      overflow:hidden;
    }

    /* Kleiner Header */
    header{
      position:fixed; top:0; left:0; right:0; height:var(--header-h); z-index:30;
      display:flex; gap:12px; align-items:center;
      padding:8px 14px; background:rgba(10,13,20,.85); border-bottom:1px solid #222a39; backdrop-filter: blur(6px);
    }
    header .dot{font-size:16px}
    header h1{font-size:14px; margin:0; font-weight:700; letter-spacing:.3px}
    header nav{margin-left:auto; display:flex; gap:10px; align-items:center}
    header a{color:var(--fg); text-decoration:none; opacity:.9; font-size:13px}
    header a:hover{opacity:1; text-decoration:underline}

    /* B√ºhne */
    .stage{position:absolute; inset: var(--header-h) 0 0 0; display:grid; place-items:center; padding:16px;}
    svg{width:min(1200px, 95vw); height:calc(95vh - var(--header-h));}

    /* Ringe */
    .ring-inner{stroke:var(--ring-inner); stroke-width:2.2; fill:none; stroke-opacity:.9}
    .ring-mid{stroke:var(--ring-mid); stroke-width:2.2; fill:none; stroke-opacity:.9}
    .ring-outer{stroke:var(--ring-outer); stroke-width:2.2; fill:none; stroke-opacity:.9}

    /* Edges */
    .edges path{
      stroke:var(--edge); stroke-width:2; fill:none; opacity:.4;
      transition:opacity .15s ease, stroke .15s ease, stroke-width .15s ease;
    }
    svg.hovering .edges path{ opacity:.18; stroke:var(--edge-dim) }
    .edges path.on{ opacity:.98; stroke:var(--edge); stroke-width:3.2 }

    /* Quer-Verbindungsstriche (Ticks) */
    .ticks line{
      stroke:var(--tick); stroke-width:1.4; opacity:.85;
      vector-effect:non-scaling-stroke;
    }
    svg.hovering .ticks line{ opacity:.35 }
    .ticks line.on{ opacity:1; stroke-width:1.8 }

    /* Nodes ‚Äì ganze Kreisfl√§che klickbar */
    svg a.node{ cursor:pointer; filter: drop-shadow(0 2px 8px rgba(0,0,0,.35)); transition: transform .15s ease, opacity .2s ease; }
    svg a.node:hover{ transform: translateY(-2px) scale(1.03); }
    .node .hit{
      r: var(--node-hit-r);
      fill:rgba(255,255,255,0.001); /* unsichtbar, f√§ngt aber Klicks zuverl√§ssig */
      stroke:var(--node-border); stroke-width:1.5; vector-effect:non-scaling-stroke;
      pointer-events:visiblePainted;
    }
    .node text{ font-size:12px; letter-spacing:.3px; text-anchor:middle; dominant-baseline:middle; pointer-events:none }
    .inner text{ fill:#f5b0ba } .mid text{ fill:#f1d86d } .outer text{ fill:#9cc1ff }

    /* farbig markieren bei Verbindung */
    .node.on.inner .hit{ fill:var(--inner-fill); stroke:var(--ring-inner) }
    .node.on.mid   .hit{ fill:var(--mid-fill);   stroke:var(--ring-mid) }
    .node.on.outer .hit{ fill:var(--outer-fill); stroke:var(--ring-outer) }
    .node.on text{ font-weight:800 }

    /* RESETBOX */
    .center circle{ fill:transparent; stroke:#8aa2c6; stroke-dasharray:4 6; stroke-width:2 }
    .center text{ fill:#ffffff; font-weight:800; font-size:28px; text-anchor:middle; dominant-baseline:middle; letter-spacing:.6px; pointer-events:none; }

    /* Tooltip */
    .tip{
      position:fixed; z-index:40; pointer-events:none;
      transform:translate(-50%, calc(-100% - 12px));
      background:#0f1624; border:1px solid #2b3548; color:var(--fg);
      padding:8px 10px; border-radius:8px; font-size:12px; white-space:nowrap;
      opacity:0; transition:opacity .15s ease, transform .15s ease; box-shadow: var(--shadow);
    }
    .tip.show{opacity:1; transform:translate(-50%, calc(-100% - 10px))}
    .tip small{color:var(--muted)}

    /* Legende */
    .legend{
      position:fixed; inset:auto 16px 16px 16px; z-index:25;
      display:flex; gap:10px; align-items:center; justify-content:center;
      background:rgba(12,16,24,.55); border:1px solid #222a39; border-radius:10px; padding:8px 10px; backdrop-filter: blur(6px);
    }
    .chip{display:inline-flex; align-items:center; gap:8px; font-size:12px}
    .sw{width:14px; height:14px; border-radius:50%}
    .sw.inner{background:var(--ring-inner)} .sw.mid{background:var(--ring-mid)} .sw.outer{background:var(--ring-outer)}

    @media (max-width:720px){ header h1{display:none} }
  </style>
</head>
<body>
  <header aria-label="Seitennavigation">
    <div class="dot">üçÑ</div>
    <h1>QUESTSYSTEM ‚Äì Modul-Ringe</h1>
    <nav>
      <a href="https://github.com/Quest42-coder/QUESTSYSTEM_PUBLIC" target="_blank" rel="noopener">Repository</a>
      <a id="nav-dignity">Dignity Clause</a>
      <a id="nav-gebote">14 Gebote</a>
      <a id="nav-discuss">Diskussion</a>
    </nav>
  </header>

  <div class="stage">
    <svg id="ringmap" viewBox="-600 -600 1200 1200"
         xmlns="http://www.w3.org/2000/svg"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         role="img" aria-label="Konzentrische Modul-Ringe des QUESTSYSTEMS">

      <!-- Ringe -->
      <circle class="ring-inner" r="220"></circle>
      <circle class="ring-mid"   r="380"></circle>
      <circle class="ring-outer" r="540"></circle>

      <!-- Verbindungen -->
      <g id="edges" class="edges"></g>
      <g id="ticks" class="ticks"></g>

      <!-- Zentrum: RESETBOX (gro√ü & klickbar) -->
      <a class="center" id="center-reset" target="_self">
        <g aria-label="Resetbox">
          <circle r="140"></circle>
          <text y="0">RESETBOX</text>
        </g>
      </a>
    </svg>
  </div>

  <div class="legend" aria-hidden="true">
    <span class="chip"><span class="sw inner"></span>Existential</span>
    <span class="chip"><span class="sw mid"></span>Societal</span>
    <span class="chip"><span class="sw outer"></span>Structural</span>
  </div>

  <div id="tip" class="tip" role="status" aria-live="polite"></div>

  <script>
    // ---- Basis-URL ----
    const BASE = (()=>{
      const u = new URL(window.location.href);
      if (u.pathname.endsWith('index.html')) u.pathname = u.pathname.replace(/index\.html$/, '');
      if (!u.pathname.endsWith('/')) u.pathname += '/';
      return u.origin + u.pathname;
    })();
    const urlFor = (filePath) => `${BASE}module.html?file=${encodeURIComponent(filePath)}`;

    // Header-Links
    document.getElementById('nav-dignity').href = urlFor('MODULES/DIGNITY_CLAUSE.md');
    document.getElementById('nav-gebote').href  = urlFor('MODULES/14_GEBOTE_V2.1.md');
    document.getElementById('nav-discuss').href = urlFor('MODULES/14_GEBOTE_DISCUSSION.md');

    // ---- Module inkl. Tags (f√ºr inhaltliche Verbindungen) ----
    const nodes = [
      // INNER ‚Äì Existential
      {label:"WATER",   ring:"inner", file:`MODULES/Modul_02_WATER.md`,   tags:["basic","survival","health","body","infrastructure"]},
      {label:"SHELTER", ring:"inner", file:`MODULES/Modul_03_SHELTER.md`, tags:["basic","survival","housing","safety","community"]},
      {label:"FOOD",    ring:"inner", file:`MODULES/Modul_04_FOOD.md`,    tags:["basic","survival","health","supply"]},
      {label:"SLEEP",   ring:"inner", file:`MODULES/Modul_05_SLEEP.md`,   tags:["basic","health","psyche","body"]},
      {label:"BODY",    ring:"inner", file:`MODULES/Modul_06_BODY.md`,    tags:["health","body","care"]},
      {label:"PSYCHE",  ring:"inner", file:`MODULES/Modul_07_PSYCHE.md`,  tags:["health","psyche","care","community"]},
      {label:"DEVICE",  ring:"inner", file:`MODULES/Modul_08_DEVICE.md`,  tags:["tech","device","data","privacy","media"]},
      {label:"DEBT",    ring:"inner", file:`MODULES/Modul_09_DEBT.md`,    tags:["economy","work","justice"]},

      // MID ‚Äì Societal
      {label:"WORK",     ring:"mid", file:`MODULES/Modul_10_WORK.md`,      tags:["economy","work","justice","education"]},
      {label:"SCHOOL",   ring:"mid", file:`MODULES/Modul_11_SCHOOL.md`,    tags:["education","knowledge","youth"]},
      {label:"BORDER",   ring:"mid", file:`MODULES/Modul_12_BORDER.md`,    tags:["justice","migration","state"]},
      {label:"NATURE",   ring:"mid", file:`MODULES/Modul_13_NATURE.md`,    tags:["climate","environment","resources"]},
      {label:"HEALTH",   ring:"mid", file:`MODULES/Modul_14_HEALTH.md`,    tags:["health","care","infrastructure"]},
      {label:"CARE",     ring:"mid", file:`MODULES/Modul_15_CARE.md`,      tags:["care","family","community","health"]},
      {label:"FAMILY",   ring:"mid", file:`MODULES/Modul_16_FAMILY.md`,    tags:["family","community","care"]},
      {label:"ANIMAL",   ring:"mid", file:`MODULES/Modul_17_ANIMAL.md`,    tags:["animal","environment","ethics"]},
      {label:"CULTURE",  ring:"mid", file:`MODULES/Modul_18_CULTURE.md`,   tags:["culture","symbol","art","media"]},
      {label:"MEDIA",    ring:"mid", file:`MODULES/Modul_19_MEDIA.md`,     tags:["media","truth","data","privacy"]},
      {label:"ENERGY",   ring:"mid", file:`MODULES/Modul_20_ENERGY.md`,    tags:["energy","infrastructure","climate"]},
      {label:"CLIMATE",  ring:"mid", file:`MODULES/Modul_21_CLIMATE.md`,   tags:["climate","environment","policy"]},
      {label:"MIGRATION",ring:"mid", file:`MODULES/Modul_22_MIGRATION.md`, tags:["migration","border","justice","community"]},
      {label:"JUSTICE",  ring:"mid", file:`MODULES/Modul_23_JUSTICE.md`,   tags:["justice","law","rights","democracy"]},
      {label:"COMMUNITY",ring:"mid", file:`MODULES/Modul_24_COMMUNITY.md`, tags:["community","care","governance"]},

      // OUTER ‚Äì Structural
      {label:"HOUSING",    ring:"outer", file:`MODULES/Modul_26_HOUSING.md`,    tags:["housing","infrastructure","community"]},
      {label:"TRANSPORT",  ring:"outer", file:`MODULES/Modul_27_TRANSPORT.md`,  tags:["transport","infrastructure","energy"]},
      {label:"NETWORK",    ring:"outer", file:`MODULES/Modul_28_NETWORK.md`,    tags:["network","data","privacy","tech"]},
      {label:"SYMBOL",     ring:"outer", file:`MODULES/Modul_29_SYMBOL.md`,     tags:["symbol","culture","truth","art"]},
      {label:"TRUTH",      ring:"outer", file:`MODULES/Modul_30_TRUTH.md`,      tags:["truth","media","knowledge"]},
      {label:"MEMORY",     ring:"outer", file:`MODULES/Modul_31_MEMORY.md`,     tags:["memory","psyche","knowledge","culture"]},
      {label:"LICENCE",    ring:"outer", file:`MODULES/Modul_32_LICENCE.md`,    tags:["licence","governance","art","data"]},
      {label:"PRIVACY",    ring:"outer", file:`MODULES/Modul_33_PRIVACY.md`,    tags:["privacy","rights","data","network"]},
      {label:"DATA",       ring:"outer", file:`MODULES/Modul_34_DATA.md`,       tags:["data","media","truth","network"]},
      {label:"CONFLICT",   ring:"outer", file:`MODULES/Modul_35_CONFLICT.md`,   tags:["conflict","justice","community"]},
      {label:"DEMOCRACY",  ring:"outer", file:`MODULES/Modul_37_DEMOCRACY.md`,  tags:["democracy","rights","justice","media"]},
      {label:"KNOWLEDGE",  ring:"outer", file:`MODULES/Modul_39_KNOWLEDGE.md`,  tags:["knowledge","education","truth","memory"]},
      {label:"ART",        ring:"outer", file:`MODULES/Modul_40_ART.md`,        tags:["art","culture","symbol","licence"]},
      {label:"FUTURE",     ring:"outer", file:`MODULES/Modul_41_FUTURE.md`,     tags:["future","education","knowledge","climate"]},
      {label:"DEATH",      ring:"outer", file:`MODULES/Modul_42_DEATH.md`,      tags:["death","psyche","health"]}
    ];

    const config = { inner:{r:220,class:"inner"}, mid:{r:380,class:"mid"}, outer:{r:540,class:"outer"} };
    const SVG_NS = "http://www.w3.org/2000/svg";
    const XLINK_NS = "http://www.w3.org/1999/xlink";
    const svg = document.getElementById('ringmap');
    const edgesLayer = document.getElementById('edges');
    const ticksLayer = document.getElementById('ticks');
    const tip = document.getElementById('tip');

    const pos = {};       // label -> {x,y}
    const nodeRef = {};   // label -> <a>
    const neighbors = {}; // label -> Set<label>
    const edgeRef = [];   // [{a,b,path,ticks: [<line>,...]}]

    // Resetbox-Link
    const resetA = document.getElementById('center-reset');
    resetA.setAttribute('href', urlFor('MODULES/Modul_01_RESETBOX.md'));
    resetA.setAttributeNS(XLINK_NS, 'xlink:href', urlFor('MODULES/Modul_01_RESETBOX.md'));

    // ---- Placement ----
    function placeNodes(){
      const groups = {inner:[], mid:[], outer:[]};
      nodes.forEach(n=>groups[n.ring].push(n));

      Object.entries(groups).forEach(([ring,list])=>{
        const radius=config[ring].r;
        const group=document.createElementNS(SVG_NS,"g");
        group.setAttribute("class",config[ring].class);
        svg.appendChild(group);

        const step=(Math.PI*2)/list.length; const start=(-Math.PI/2);

        list.forEach((n,idx)=>{
          const angle=start+idx*step;
          const x=Math.cos(angle)*radius;
          const y=Math.sin(angle)*radius;
          pos[n.label] = {x,y};

          const url = urlFor(n.file);
          const a=document.createElementNS(SVG_NS,"a");
          a.setAttribute("href", url);
          a.setAttributeNS(XLINK_NS, "xlink:href", url);
          a.setAttribute("target","_self");
          a.setAttribute("transform",`translate(${x},${y})`);
          a.classList.add("node",config[ring].class);
          a.dataset.label = n.label;
          nodeRef[n.label]=a;

          // Klickfl√§che (ganzer Kreis)
          const hit=document.createElementNS(SVG_NS,"circle");
          hit.setAttribute("class","hit");
          a.appendChild(hit);

          const text=document.createElementNS(SVG_NS,"text");
          text.textContent=n.label; a.appendChild(text);

          // Tooltip & Hover-Hervorhebung
          a.addEventListener('mouseenter',e=>{ showTip(n.label,e); svg.classList.add('hovering'); highlight(n.label,true); });
          a.addEventListener('mousemove',e=>moveTip(e));
          a.addEventListener('mouseleave',()=>{ hideTip(); svg.classList.remove('hovering'); highlight(n.label,false); });

          // Fallback f√ºr harte Navigation
          a.addEventListener('click', (e) => {
            setTimeout(() => {
              if (location.href.indexOf('module.html') === -1) location.href = url;
            }, 0);
          });

          group.appendChild(a);
        });
      });
    }

    // ---- Kanten aus Tags berechnen ----
    function computeEdgesByTags(){
      const labelByIdx = nodes.map(n=>n.label);
      const tagsets = nodes.map(n=>new Set(n.tags||[]));
      const pairs = [];
      for(let i=0;i<nodes.length;i++){
        for(let j=i+1;j<nodes.length;j++){
          const A = tagsets[i], B = tagsets[j];
          let share=false;
          for(const t of A){ if(B.has(t)){ share=true; break; } }
          if(share) pairs.push([labelByIdx[i], label
